<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>or√ßamentos | FS Solu√ß√µes</title>

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
            background: #f5f5f5;
        }

        .header {
            padding: 16px 20px;
            background: #ffffff;
            border-bottom: 1px solid #ddd;
            font-size: 18px;
            font-weight: 600;
        }

        .frame-container {
            position: relative;
            height: calc(100vh - 90px); /* tela inteira menos header + margem */
            padding: 10px 10px 70px;    /* espa√ßo pro bot√£o voltar */
            box-sizing: border-box;
        }

        .app-frame {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            background: #fff;
        }

        /* BOT√ÉO VOLTAR FIXO NO RODAP√â */
        .btn-voltar {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #0a58ca;
            color: #fff;
            padding: 10px 16px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.25);
            z-index: 9999;
        }
    </style>
</head>
<body>

    <div class="header">
        FS Solu√ß√µes ‚Äì Or√ßamentos
    </div>

    <div class="frame-container">
        <!-- <!doctype html>
<html lang="pt-BR">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Vendas Zenir</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100%;
            color: #2d3748;
            display: flex;
            flex-direction: column;
        }

        * {
            box-sizing: border-box;
        }

        .page-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 1.5rem 0;
            margin-bottom: 1rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .logo-svg {
            width: 78px;
            height: 78px;
            filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.3));
        }

        /* Anima√ß√µes da Logo Financeira */
        .rotating-circle {
            animation: rotate-clockwise 8s linear infinite;
            transform-origin: center;
        }

        @keyframes rotate-clockwise {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .dollar-sign {
            animation: pulse-glow 2s ease-in-out infinite;
            transform-origin: center;
        }

        @keyframes pulse-glow {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.05);
                opacity: 0.9;
            }
        }

        .growth-arrows {
            animation: rotate-counter 10s linear infinite;
            transform-origin: center;
        }

        @keyframes rotate-counter {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(-360deg);
            }
        }

        .orbital-particles {
            animation: rotate-clockwise 6s linear infinite;
            transform-origin: center;
        }

        .orbit-1 {
            animation: pulse-particle 1.5s ease-in-out infinite;
        }

        .orbit-2 {
            animation: pulse-particle 1.5s ease-in-out 0.3s infinite;
        }

        .orbit-3 {
            animation: pulse-particle 1.5s ease-in-out 0.6s infinite;
        }

        .orbit-4 {
            animation: pulse-particle 1.5s ease-in-out 0.9s infinite;
        }

        @keyframes pulse-particle {
            0%, 100% {
                opacity: 0.6;
                transform: scale(1);
            }
            50% {
                opacity: 1;
                transform: scale(1.3);
            }
        }

        .logo-text {
            text-align: left;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .app-title {
            font-size: 1.5rem;
            font-weight: 800;
            margin: 0;
            color: #ffffff;
            text-shadow: 0 4px 15px rgba(0,0,0,0.3);
            line-height: 1.1;
            letter-spacing: -0.02em;
        }

        .system-subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.85rem;
            font-weight: 600;
            margin: 0;
            text-shadow: 0 2px 5px rgba(0,0,0,0.2);
            letter-spacing: 0.3px;
        }

        .company-name {
            color: #ffd700;
            font-size: 0.85rem;
            font-weight: 700;
            margin: 0;
            text-shadow: 0 2px 8px rgba(255, 215, 0, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-wrap: nowrap;
        }

        .user-welcome {
            font-size: 0.95rem;
            font-weight: 600;
            color: white;
            white-space: nowrap;
        }

        .user-menu {
            position: relative;
            z-index: 100;
        }

        .menu-toggle {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 0.5rem 0.75rem;
            border-radius: 10px;
            font-size: 1.5rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 45px;
            height: 45px;
        }

        .menu-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .menu-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-width: 220px;
            overflow: hidden;
            display: none;
            animation: slideDown 0.3s ease;
        }

        .menu-dropdown.active {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .menu-header {
            background: rgba(0, 0, 0, 0.2);
            color: white;
            padding: 1rem;
            font-size: 0.9rem;
            font-weight: 700;
            text-align: center;
        }

        .menu-current-user {
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .current-user-label {
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.25rem;
        }

        .current-user-name {
            font-size: 0.9rem;
            color: white;
            font-weight: 700;
        }

        .menu-actions {
            padding: 0.5rem 0;
        }

        .menu-item {
            display: block;
            width: 100%;
            padding: 0.75rem 1rem;
            border: none;
            background: none;
            text-align: left;
            font-size: 0.85rem;
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        .menu-item.danger {
            color: #ffd700;
        }

        .menu-item.danger:hover {
            background: rgba(255, 215, 0, 0.2);
        }

        .btn-calculator {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 0.5rem 0.75rem;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 45px;
            height: 45px;
        }

        .btn-calculator:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        @media (max-width: 768px) {
            .header {
                padding: 1rem 0;
            }

            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }

            .logo-section {
                flex-direction: column;
                gap: 0.75rem;
            }

            .logo-text {
                text-align: center;
            }

            .header-actions {
                justify-content: center;
                width: 100%;
            }

            .app-title {
                font-size: 1.3rem;
            }

            .system-subtitle {
                font-size: 0.75rem;
            }

            .company-name {
                font-size: 0.8rem;
            }

            .logo-svg {
                width: 65px;
                height: 65px;
            }
        }

        .calculator-card, .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            margin-bottom: 1.5rem;
        }

        .login-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .login-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #4a5568;
            margin-bottom: 0.5rem;
        }

        .login-header p {
            color: #718096;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .btn-login {
            width: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            margin-top: 1rem;
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        /* Estilos da Calculadora Modal */
        .calculator-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10000;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding-top: 2rem;
            animation: fadeIn 0.3s ease;
        }

        .calculator-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .calculator-container {
            position: relative;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
            max-width: 350px;
            width: 90%;
            max-height: 90%;
        }

        .calculator-header {
            background: rgba(0, 0, 0, 0.2);
            padding: 1.2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .calculator-header h3 {
            margin: 0;
            color: white;
            font-size: 1.3rem;
            font-weight: 700;
        }

        .calculator-close {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calculator-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .calculator-body {
            padding: 1.2rem;
        }

        .calculator-display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 1.2rem;
            margin-bottom: 1.2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .calculator-display input {
            width: 100%;
            background: transparent;
            border: none;
            color: #ffffff;
            font-size: 1.8rem;
            font-weight: 700;
            text-align: right;
            font-family: 'Courier New', monospace;
            outline: none;
            margin-bottom: 0.3rem;
        }

        .calculator-history {
            color: #ffd700;
            font-size: 1rem;
            text-align: right;
            font-family: 'Courier New', monospace;
            min-height: 1.2rem;
            opacity: 0.8;
            margin-bottom: 0.5rem;
        }

        .calculator-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.8rem;
        }

        .btn-calc {
            padding: 1rem;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-calc:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .btn-calc:active {
            transform: translateY(0);
        }

        .btn-number {
            background: rgba(255, 255, 255, 0.9);
            color: #2d3748;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .btn-number:hover {
            background: rgba(255, 255, 255, 1);
        }

        .btn-operator {
            background: rgba(255, 215, 0, 0.9);
            color: #2d3748;
        }

        .btn-operator:hover {
            background: rgba(255, 215, 0, 1);
        }

        .btn-function {
            background: rgba(255, 255, 255, 0.7);
            color: #2d3748;
        }

        .btn-function:hover {
            background: rgba(255, 255, 255, 0.9);
        }

        .btn-equals {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            grid-row: span 2;
            font-size: 1.3rem;
        }

        .btn-equals:hover {
            background: linear-gradient(135deg, #5a67d8, #6b46c1);
        }

        @media (max-width: 768px) {
            .calculator-container {
                width: 95%;
                max-width: 380px;
            }

            .calculator-header {
                padding: 1rem;
            }

            .calculator-header h3 {
                font-size: 1.1rem;
            }

            .calculator-body {
                padding: 1rem;
            }

            .calculator-display input {
                font-size: 1.6rem;
            }

            .btn-calc {
                padding: 0.8rem;
                min-height: 45px;
                font-size: 1rem;
            }

            .calculator-buttons {
                gap: 0.6rem;
            }
        }

        .input-group {
            margin-bottom: 1.25rem;
        }

        .input-label {
            display: block;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: #4a5568;
            font-size: 0.95rem;
        }

        .input-field {
            width: 100%;
            padding: 0.85rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            background: white;
        }

        .input-field:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .price-input {
            position: relative;
        }

        .currency-symbol {
            position: absolute;
            left: 0.85rem;
            top: 50%;
            transform: translateY(-50%);
            color: #667eea;
            font-weight: 700;
            font-size: 0.95rem;
            pointer-events: none;
        }

        .price-input .input-field {
            padding-left: 3rem;
        }

        .percent-input {
            position: relative;
        }

        .percent-symbol {
            position: absolute;
            right: 0.85rem;
            top: 50%;
            transform: translateY(-50%);
            color: #667eea;
            font-weight: 700;
            font-size: 0.95rem;
            pointer-events: none;
        }

        .percent-input .input-field {
            padding-right: 3rem;
        }

        .calculation-section {
            margin: 0.875rem 0;
            padding: 0.875rem;
            border-radius: 10px;
            border: 1.5px solid;
            position: relative;
            overflow: hidden;
        }

        .section-auto {
            background: rgba(16, 185, 129, 0.1);
            border-color: rgba(16, 185, 129, 0.3);
        }

        .section-manual {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .section-payment {
            background: rgba(147, 51, 234, 0.1);
            border-color: rgba(147, 51, 234, 0.3);
        }

        .section-title {
            font-size: 1.05rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #4a5568;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .payment-options {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .payment-options label {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            cursor: pointer;
            font-weight: 600;
            color: #4a5568;
            font-size: 0.85rem;
        }

        .payment-options input[type="radio"] {
            width: 16px;
            height: 16px;
            accent-color: #667eea;
        }

        .parcelas-group {
            display: none;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .parcelas-group.active {
            display: grid;
        }

        .result-section {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            margin: 1.25rem 0;
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
        }

        .discount-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.25rem;
            margin-bottom: 1.25rem;
        }

        .discount-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 1.25rem;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 3px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .discount-item:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.2);
        }

        .discount-item.discount-red {
            border-color: #f56565;
            background: rgba(245, 101, 101, 0.15);
        }

        .discount-item.discount-red:hover {
            background: rgba(245, 101, 101, 0.25);
            box-shadow: 0 5px 20px rgba(245, 101, 101, 0.3);
        }

        .discount-item.discount-green {
            border-color: #48bb78;
            background: rgba(72, 187, 120, 0.15);
        }

        .discount-item.discount-green:hover {
            background: rgba(72, 187, 120, 0.25);
            box-shadow: 0 5px 20px rgba(72, 187, 120, 0.3);
        }

        .discount-label {
            font-size: 0.8rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .discount-value {
            font-size: 1.4rem;
            font-weight: 800;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 1.75rem;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
        }

        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .btn-whatsapp {
            background: linear-gradient(135deg, #25d366, #128c7e);
            color: white;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .history-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            border: 1px solid rgba(255,255,255,0.3);
        }

        .history-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.25rem;
            color: #4a5568;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .date-filter {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 15px;
            border: 2px solid rgba(102, 126, 234, 0.2);
        }

        .filter-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-controls input {
            flex: 1;
            min-width: 200px;
        }

        .success-filter {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(72, 187, 120, 0.1);
            border-radius: 10px;
            border: 2px solid rgba(72, 187, 120, 0.2);
        }

        .success-filter-controls {
            display: flex;
            gap: 1.5rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .success-filter label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            color: #4a5568;
            cursor: pointer;
            font-size: 0.95rem;
        }

        .success-filter input[type="radio"] {
            width: 18px;
            height: 18px;
            accent-color: #48bb78;
        }

        .success-checkbox {
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
            padding: 0.75rem 1rem;
            background: rgba(72, 187, 120, 0.1);
            border-radius: 10px;
            border: 2px solid rgba(72, 187, 120, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .success-checkbox:hover {
            background: rgba(72, 187, 120, 0.15);
            border-color: rgba(72, 187, 120, 0.3);
        }

        .success-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #48bb78;
        }

        .success-checkbox label {
            font-weight: 600;
            color: #4a5568;
            cursor: pointer;
            margin: 0;
            font-size: 0.95rem;
        }

        .success-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 15px;
            font-weight: 700;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .success-status.success {
            background: rgba(72, 187, 120, 0.2);
            color: #2f855a;
            border: 1px solid rgba(72, 187, 120, 0.3);
        }

        .success-status.pending {
            background: rgba(237, 137, 54, 0.2);
            color: #c05621;
            border: 1px solid rgba(237, 137, 54, 0.3);
        }

        .dashboard-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(147, 51, 234, 0.1);
            border-radius: 15px;
            border: 2px solid rgba(147, 51, 234, 0.2);
        }

        .summary-card {
            background: rgba(255, 255, 255, 0.8);
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 4px solid;
            transition: all 0.3s ease;
        }

        .summary-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .summary-card.total {
            border-left-color: #667eea;
        }

        .summary-card.success {
            border-left-color: #48bb78;
        }

        .summary-card.pending {
            border-left-color: #ed8936;
        }

        .summary-card.rate {
            border-left-color: #9f7aea;
        }

        .summary-number {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            color: #2d3748;
        }

        .summary-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .filter-btn.secondary {
            background: linear-gradient(135deg, #718096, #4a5568);
        }

        .filter-btn.secondary:hover {
            background: linear-gradient(135deg, #4a5568, #2d3748);
        }

        .history-item {
            background: rgba(248, 250, 252, 0.8);
            padding: 1.25rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .history-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            background: rgba(255, 255, 255, 0.9);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .client-name {
            font-weight: 700;
            color: #4a5568;
            font-size: 0.95rem;
        }

        .history-date {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .history-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .detail-item {
            padding: 1rem;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 8px;
            border-left: 3px solid #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .detail-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        .detail-label {
            font-weight: 700;
            color: #718096;
            font-size: 0.75rem;
            margin-bottom: 0.35rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .detail-value {
            font-weight: 700;
            color: #2d3748;
            font-size: 0.95rem;
        }

        .history-notes {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 8px;
            border-left: 3px solid #667eea;
        }

        .notes-content {
            font-style: italic;
            color: #4a5568;
            line-height: 1.5;
            margin: 0.35rem 0 0 0;
            font-size: 0.9rem;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
            color: #718096;
        }

        .spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #718096;
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            opacity: 0.7;
        }

        .status-authorization {
            margin-top: 0.75rem;
            padding: 0.75rem;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            display: none;
            border: 2px solid;
            font-size: 0.8rem;
            line-height: 1.3;
        }

        .status-vendedor {
            background: rgba(255, 193, 7, 0.1);
            border-color: #ffc107;
            color: #856404;
        }

        .status-gerente {
            background: rgba(255, 152, 0, 0.1);
            border-color: #ff9800;
            color: #e65100;
        }

        .status-supervisor {
            background: rgba(244, 67, 54, 0.1);
            border-color: #f44336;
            color: #c62828;
        }

        .security-notice {
            background: rgba(244, 67, 54, 0.1);
            border: 2px solid #f44336;
            border-radius: 12px;
            padding: 1rem;
            margin-top: 1.25rem;
            text-align: center;
        }

        .security-notice h4 {
            color: #c62828;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
            font-weight: 700;
        }

        .security-notice p {
            color: #c62828;
            line-height: 1.5;
            font-size: 0.85rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 0.75rem;
            }

            .calculator-card, .login-card, .history-section {
                padding: 1.25rem;
            }

            .discount-display {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .history-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .filter-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-controls input {
                min-width: auto;
            }

            .history-details {
                grid-template-columns: 1fr;
            }

            .parcelas-group {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .payment-options {
                flex-direction: column;
                gap: 0.5rem;
            }

            .dashboard-summary {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .success-filter-controls {
                flex-direction: column;
                align-items: stretch;
            }
        }

        .fade-in {
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .toast.success {
            background: linear-gradient(135deg, #48bb78, #38a169);
        }

        .toast.error {
            background: linear-gradient(135deg, #f56565, #e53e3e);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .message-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            animation: fadeIn 0.3s ease;
        }

        .message-modal.active {
            display: flex;
        }

        .message-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .message-container {
            position: relative;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            max-width: 600px;
            width: 100%;
            max-height: 90%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .message-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .message-header h3 {
            margin: 0;
            color: white;
            font-size: 1.3rem;
            font-weight: 700;
        }

        .message-close {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .message-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .message-body {
            padding: 1.5rem;
            overflow-y: auto;
            flex: 1;
        }

        .message-content {
            background: rgba(102, 126, 234, 0.05);
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 15px;
            padding: 1.5rem;
            white-space: pre-wrap;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.8;
            color: #2d3748;
            font-size: 0.95rem;
        }

        .message-actions {
            padding: 1rem 1.5rem;
            background: rgba(248, 250, 252, 0.8);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        @media (max-width: 768px) {
            .message-container {
                max-width: 95%;
            }

            .message-header {
                padding: 1rem;
            }

            .message-header h3 {
                font-size: 1.1rem;
            }

            .message-body {
                padding: 1rem;
            }

            .message-content {
                padding: 1rem;
                font-size: 0.9rem;
            }
        }

        .developer-signature {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 1.5rem 1rem;
            margin-top: auto;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .signature-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .developer-name {
            color: #ffd700;
            font-weight: 700;
            font-size: 1rem;
        }

        .signature-main {
            margin: 0;
            font-size: 0.9rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
        }

        .signature-subtitle {
            margin: 0.5rem 0 0 0;
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <header class="header">
   <div class="container">
    <div class="header-content">
     <div class="logo-section">
      <div class="logo-container">
       <svg class="logo-svg" viewbox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><defs>
         <lineargradient id="goldGradient" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#ffd700;stop-opacity:1" />
          <stop offset="50%" style="stop-color:#ffed4e;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#ffa500;stop-opacity:1" />
         </lineargradient>
         <lineargradient id="purpleGradient" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
          <stop offset="50%" style="stop-color:#8b9dff;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
         </lineargradient>
         <lineargradient id="greenGradient" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#48bb78;stop-opacity:1" />
          <stop offset="50%" style="stop-color:#68d391;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#38a169;stop-opacity:1" />
         </lineargradient>
         <filter id="shadow">
          <fegaussianblur in="SourceAlpha" stddeviation="2" />
          <feoffset dx="0" dy="2" result="offsetblur" />
          <fecomponenttransfer>
           <fefunca type="linear" slope="0.4" />
          </fecomponenttransfer>
          <femerge>
           <femergenode />
           <femergenode in="SourceGraphic" />
          </femerge>
         </filter>
         <filter id="glow">
          <fegaussianblur stddeviation="3" result="coloredBlur" />
          <femerge>
           <femergenode in="coloredBlur" />
           <femergenode in="SourceGraphic" />
          </femerge>
         </filter>
        </defs> <!-- C√≠rculo externo rotativo --> <g class="rotating-circle" filter="url(#shadow)">
         <circle cx="50" cy="50" r="42" fill="none" stroke="url(#purpleGradient)" stroke-width="3" opacity="0.3" />
         <circle cx="50" cy="50" r="38" fill="none" stroke="url(#goldGradient)" stroke-width="2" opacity="0.5" stroke-dasharray="10 5" />
        </g> <!-- S√≠mbolo de cifr√£o central rotativo --> <g class="dollar-sign" filter="url(#glow)">
         <circle cx="50" cy="50" r="28" fill="url(#purpleGradient)" />
         <circle cx="50" cy="50" r="25" fill="none" stroke="#fff" stroke-width="2" opacity="0.3" /> <!-- R$ --> <!-- Letra R -->
         <path d="M 38 38 L 38 62 M 38 38 L 45 38 Q 48 38 48 41 Q 48 44 45 44 L 38 44 M 45 44 L 48 50" fill="none" stroke="#fff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" /> <!-- Cifr√£o $ -->
         <path d="M 56 35 L 56 65" stroke="#ffd700" stroke-width="3" stroke-linecap="round" />
         <path d="M 52 40 Q 52 35 56 35 Q 60 35 60 40 Q 60 44 56 44 Q 52 44 52 48 Q 52 52 56 52 Q 60 52 60 56 Q 60 61 56 61 Q 52 61 52 56" fill="none" stroke="#ffd700" stroke-width="2.5" stroke-linecap="round" />
        </g> <!-- Setas de crescimento rotativas --> <g class="growth-arrows" filter="url(#shadow)"><!-- Seta 1 -->
         <path d="M 20 60 L 30 50 L 25 50 L 25 45 L 35 45 L 35 50 L 30 50" fill="url(#greenGradient)" opacity="0.8" /> <!-- Seta 2 -->
         <path d="M 80 40 L 70 50 L 75 50 L 75 55 L 65 55 L 65 50 L 70 50" fill="url(#goldGradient)" opacity="0.8" /> <!-- Seta 3 -->
         <path d="M 50 15 L 55 25 L 52 25 L 52 30 L 48 30 L 48 25 L 45 25" fill="url(#greenGradient)" opacity="0.8" /> <!-- Seta 4 -->
         <path d="M 50 85 L 45 75 L 48 75 L 48 70 L 52 70 L 52 75 L 55 75" fill="url(#goldGradient)" opacity="0.8" />
        </g> <!-- Part√≠culas orbitais --> <g class="orbital-particles">
         <circle class="particle orbit-1" cx="85" cy="50" r="3" fill="#ffd700" filter="url(#glow)" />
         <circle class="particle orbit-2" cx="15" cy="50" r="3" fill="#48bb78" filter="url(#glow)" />
         <circle class="particle orbit-3" cx="50" cy="15" r="2.5" fill="#667eea" filter="url(#glow)" />
         <circle class="particle orbit-4" cx="50" cy="85" r="2.5" fill="#ffd700" filter="url(#glow)" />
        </g>
       </svg>
      </div>
      <div class="logo-text">
       <h1 class="app-title" id="appTitle">Sistema de Vendas Zenir</h1>
       <p class="system-subtitle" id="systemSubtitle">Sistema de C√°lculo de Descontos</p>
       <p class="company-name" id="motivationalMessage">üí™ Vamos fazer grandes vendas hoje!</p>
      </div>
     </div>
     <div class="header-actions" id="headerActions" style="display: none;"><!-- Menu de Usu√°rios -->
      <div class="user-menu" id="userMenu"><button class="menu-toggle" onclick="toggleUserMenu()"> ‚ãÆ </button>
       <div class="menu-dropdown" id="menuDropdown">
        <div class="menu-header">
         üîß Gerenciar Usu√°rios
        </div>
        <div class="menu-current-user">
         <div class="current-user-label">
          üë§ Usu√°rio Ativo
         </div>
         <div class="current-user-name" id="menuCurrentUser">
          -
         </div>
        </div>
        <div class="menu-actions"><button class="menu-item" onclick="trocarUsuario()"> üîÑ Trocar Usu√°rio </button> <button class="menu-item" onclick="verHistoricoCompleto()"> üìä Ver Todos os Registros </button> <button class="menu-item danger" onclick="logout()"> üö™ Sair do Sistema </button>
        </div>
       </div>
      </div><button type="button" class="btn-calculator" onclick="toggleCalculator()">üßÆ</button>
     </div>
    </div>
   </div>
  </header><!-- Modal de Visualiza√ß√£o de Mensagem -->
  <div class="message-modal" id="messageModal">
   <div class="message-overlay" onclick="fecharModalMensagem()"></div>
   <div class="message-container">
    <div class="message-header">
     <h3>üì± Mensagem do WhatsApp</h3><button class="message-close" onclick="fecharModalMensagem()">‚úï</button>
    </div>
    <div class="message-body">
     <div class="message-content" id="messageContent"></div>
    </div>
    <div class="message-actions"><button type="button" class="btn btn-secondary" onclick="copiarMensagem()" style="padding: 0.75rem 1.5rem; font-size: 0.9rem; min-width: 150px;"> üìã Copiar Mensagem </button> <button type="button" class="btn btn-whatsapp" onclick="enviarMensagemAtual()" style="padding: 0.75rem 1.5rem; font-size: 0.9rem; min-width: 150px;"> üì± Enviar WhatsApp </button>
    </div>
   </div>
  </div>
  <div class="page-wrapper">
   <main class="container"><!-- Tela de Autoriza√ß√£o -->
    <div class="login-card fade-in" id="authCard" style="display: block;">
     <div class="login-header">
      <h2>üîê Autoriza√ß√£o do Sistema</h2>
      <p>Digite seu nome e a senha gerencial para autorizar esta plataforma.</p>
     </div>
     <form id="authForm">
      <div class="input-group"><label class="input-label" for="nomeUsuario">üë§ Seu Nome Completo:</label> <input type="text" id="nomeUsuario" class="input-field" placeholder="Digite seu nome completo" required>
      </div>
      <div class="input-group"><label class="input-label" for="senhaGerente">üîë Senha Gerencial:</label> <input type="password" id="senhaGerente" class="input-field" placeholder="Digite a senha gerencial" required>
      </div><button type="submit" class="btn-login"> üöÄ Autorizar Sistema </button>
     </form>
    </div><!-- Tela de Login -->
    <div class="login-card fade-in" id="loginCard" style="display: none;">
     <div class="login-header">
      <h2>üëã Bem-vindo ao Sistema Zenir!</h2>
      <p>Digite seu nome completo para acessar a calculadora de descontos</p>
     </div>
     <form id="loginForm">
      <div class="input-group"><label class="input-label" for="nomeVendedor">üë§ Seu Nome Completo:</label> <input type="text" id="nomeVendedor" class="input-field" placeholder="Digite seu nome completo" required>
      </div><button type="submit" class="btn-login"> üöÄ Entrar no Sistema </button>
     </form>
    </div><!-- Calculadora Principal -->
    <div class="calculator-card fade-in" id="calculatorCard" style="display: none;"><!-- Calculadora Modal -->
     <div class="calculator-modal" id="calculatorModal" style="display: none;">
      <div class="calculator-overlay" onclick="closeCalculator()"></div>
      <div class="calculator-container">
       <div class="calculator-header">
        <h3>üßÆ Calculadora</h3><button class="calculator-close" onclick="closeCalculator()">‚úï</button>
       </div>
       <div class="calculator-body">
        <div class="calculator-display"><input type="text" id="calculatorDisplay" readonly value="0">
         <div class="calculator-history" id="calculatorHistory"></div>
        </div>
        <div class="calculator-buttons"><!-- Linha 1: Fun√ß√µes cient√≠ficas --> <button onclick="clearAll()" class="btn-calc btn-function">C</button> <button onclick="clearEntry()" class="btn-calc btn-function">CE</button> <button onclick="backspace()" class="btn-calc btn-function">‚å´</button> <button onclick="appendOperator('/')" class="btn-calc btn-operator">√∑</button> <!-- Linha 2: Fun√ß√µes avan√ßadas --> <button onclick="calculateFunction('sqrt')" class="btn-calc btn-function">‚àö</button> <button onclick="calculateFunction('square')" class="btn-calc btn-function">x¬≤</button> <button onclick="calculateFunction('percent')" class="btn-calc btn-function">%</button> <button onclick="appendOperator('*')" class="btn-calc btn-operator">√ó</button> <!-- Linha 3: N√∫meros --> <button onclick="appendNumber('7')" class="btn-calc btn-number">7</button> <button onclick="appendNumber('8')" class="btn-calc btn-number">8</button> <button onclick="appendNumber('9')" class="btn-calc btn-number">9</button> <button onclick="appendOperator('-')" class="btn-calc btn-operator">‚àí</button> <!-- Linha 4: N√∫meros --> <button onclick="appendNumber('4')" class="btn-calc btn-number">4</button> <button onclick="appendNumber('5')" class="btn-calc btn-number">5</button> <button onclick="appendNumber('6')" class="btn-calc btn-number">6</button> <button onclick="appendOperator('+')" class="btn-calc btn-operator">+</button> <!-- Linha 5: N√∫meros --> <button onclick="appendNumber('1')" class="btn-calc btn-number">1</button> <button onclick="appendNumber('2')" class="btn-calc btn-number">2</button> <button onclick="appendNumber('3')" class="btn-calc btn-number">3</button> <button onclick="calculate()" class="btn-calc btn-equals" rowspan="2">=</button> <!-- Linha 6: Zero e decimal --> <button onclick="toggleSign()" class="btn-calc btn-function">¬±</button> <button onclick="appendNumber('0')" class="btn-calc btn-number">0</button> <button onclick="appendDecimal()" class="btn-calc btn-number">,</button>
        </div>
       </div>
      </div>
     </div>
     <form id="discountForm">
      <div class="input-group"><label class="input-label" for="codigoProduto">üì¶ C√≥digo do Produto:</label> <input type="text" id="codigoProduto" class="input-field" placeholder="Ex: PRD001, SKU123, ITEM456..." required>
      </div>
      <div class="input-group"><label class="input-label" for="precoNormal" style="font-size: 1.3rem; color: #667eea; text-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);">üí∞ Pre√ßo de Tabela:</label>
       <div class="price-input"><span class="currency-symbol" id="currencySymbol1">R$</span> <input type="text" id="precoNormal" class="input-field" placeholder="Digite o pre√ßo normal do produto" required>
       </div><!-- Modalidade de Pagamento - Pre√ßo Normal -->
       <div style="margin-top: 1.5rem; padding: 1.5rem; background: rgba(147, 51, 234, 0.1); border-radius: 15px; border: 2px solid rgba(147, 51, 234, 0.2);">
        <h4 style="font-size: 1rem; font-weight: 700; margin-bottom: 1rem; color: #4a5568; display: flex; align-items: center; gap: 0.5rem;">üí≥ Modalidades - Pre√ßo de Tabela</h4>
        <div class="payment-options"><label> <input type="radio" name="modalidadeNormal" value="vista" checked onchange="toggleParcelasNormal()"> <span>√Ä Vista</span> </label> <label> <input type="radio" name="modalidadeNormal" value="parcelado" onchange="toggleParcelasNormal()"> <span>Parcelado</span> </label>
        </div>
        <div id="parcelasNormalGroup" class="parcelas-group">
         <div><label class="input-label" style="font-size: 0.9rem;">Parcelas:</label> <input type="number" id="parcelasNormal" class="input-field" min="2" max="24" placeholder="Ex: 12">
         </div>
         <div><label class="input-label" style="font-size: 0.9rem;">Valor da Parcela:</label>
          <div class="price-input"><span class="currency-symbol">R$</span> <input type="text" id="valorParcelaNormal" class="input-field" placeholder="0,00" style="padding-left: 3.5rem;">
          </div>
         </div>
         <div><label class="input-label" style="font-size: 0.9rem;">Tipo:</label> <select id="tipoParcelaNormal" class="input-field"> <option value="cartao">Cart√£o</option> <option value="carne">Carn√™</option> </select>
         </div>
        </div>
       </div>
      </div><!-- Se√ß√£o: C√°lculo Autom√°tico por Percentual -->
      <div class="calculation-section section-auto">
       <h3 class="section-title">üéØ C√°lculo Autom√°tico por Percentual</h3>
       <div class="input-group"><label class="input-label" for="percentualDesconto">üìä Percentual de Desconto (%):</label>
        <div class="percent-input"><input type="number" id="percentualDesconto" class="input-field" placeholder="" step="0.1" min="0" max="10"> <span class="percent-symbol">%</span>
        </div>
       </div>
       <div id="precoCalculadoGroup" style="display: none; margin-top: 1rem; padding: 1rem; background: rgba(72, 187, 120, 0.15); border-radius: 12px; border: 2px solid rgba(72, 187, 120, 0.3);"><label class="input-label" style="color: #2f855a; font-size: 0.85rem; margin-bottom: 0.5rem; font-weight: 600;">‚úÖ Pre√ßo Especial:</label>
        <div class="price-input"><span class="currency-symbol" id="currencySymbol2" style="font-size: 1.3rem; font-weight: 800;">R$</span> <input type="text" id="precoCalculado" class="input-field" readonly style="background: rgba(72, 187, 120, 0.1); font-weight: 800; color: #2f855a; cursor: not-allowed; padding-left: 3rem; font-size: 1.5rem;">
        </div>
       </div>
       <div id="statusAutorizacao" class="status-authorization"><span id="textoAutorizacao"></span>
       </div>
      </div><!-- Se√ß√£o: C√°lculo Manual -->
      <div class="calculation-section section-manual">
       <h3 class="section-title">‚úèÔ∏è OU Informe o Pre√ßo Promocional Manualmente</h3>
       <div class="input-group"><label class="input-label" for="precoPromocional" style="font-size: 1.3rem; color: #f56565; text-shadow: 0 2px 4px rgba(245, 101, 101, 0.3);">üî• Pre√ßo Promocional Final:</label>
        <div class="price-input"><span class="currency-symbol" id="currencySymbol3">R$</span> <input type="text" id="precoPromocional" class="input-field" placeholder="Digite o pre√ßo final que ser√° cobrado...">
        </div>
       </div>
      </div><!-- Se√ß√£o: Modalidade de Pagamento - Pre√ßo Promocional -->
      <div class="calculation-section section-payment">
       <h3 class="section-title">üí≥ Modalidade de Pagamento - Pre√ßo Promocional</h3>
       <div class="input-group">
        <div class="payment-options"><label> <input type="radio" name="modalidadePromocional" value="vista" checked onchange="toggleParcelasPromocional()"> <span>√Ä Vista</span> </label> <label> <input type="radio" name="modalidadePromocional" value="parcelado" onchange="toggleParcelasPromocional()"> <span>Parcelado</span> </label>
        </div>
        <div id="parcelasPromocionalGroup" class="parcelas-group">
         <div><label class="input-label" style="font-size: 0.9rem;">Parcelas:</label> <input type="number" id="parcelasPromocional" class="input-field" min="2" max="24" placeholder="Ex: 12">
         </div>
         <div><label class="input-label" style="font-size: 0.9rem;">Valor da Parcela:</label>
          <div class="price-input"><span class="currency-symbol">R$</span> <input type="text" id="valorParcelaPromocional" class="input-field" placeholder="0,00" style="padding-left: 3.5rem;">
          </div>
         </div>
         <div><label class="input-label" style="font-size: 0.9rem;">Tipo:</label> <select id="tipoParcelaPromocional" class="input-field"> <option value="cartao">Cart√£o</option> <option value="carne">Carn√™</option> </select>
         </div>
        </div>
       </div>
      </div>
      <div class="input-group"><label class="input-label" for="cliente">üë§ Nome do Cliente:</label> <input type="text" id="cliente" class="input-field" placeholder="Digite o nome completo do cliente" required>
      </div>
      <div class="input-group"><label class="input-label" for="whatsapp">üì± WhatsApp do Cliente:</label> <input type="tel" id="whatsapp" class="input-field" placeholder="(11) 99999-9999" maxlength="15">
      </div>
      <div class="input-group"><label class="input-label" for="anotacoes">üìù Anota√ß√µes da Negocia√ß√£o:</label> <textarea id="anotacoes" class="input-field" rows="4" placeholder="Ex: Cliente interessado em outros produtos, condi√ß√µes especiais de pagamento, observa√ß√µes importantes para a venda..." style="resize: vertical; min-height: 100px; font-family: inherit;"></textarea>
      </div>
     </form>
     <div class="result-section" id="resultSection" style="display: none;">
      <div class="discount-display">
       <div class="discount-item discount-red">
        <div class="discount-label">
         üìä Desconto Aplicado
        </div>
        <div class="discount-value" id="descontoPercentual">
         0%
        </div>
       </div>
       <div class="discount-item discount-green">
        <div class="discount-label">
         üí∞ Economia Total
        </div>
        <div class="discount-value" id="descontoValor">
         R$ 0,00
        </div>
       </div>
      </div>
      <div class="action-buttons"><button type="button" class="btn btn-primary" id="salvarBtn"> üíæ Salvar C√°lculo </button> <button type="button" class="btn btn-secondary" onclick="limparFormulario()"> üîÑ Novo C√°lculo </button>
      </div>
     </div>
     <div class="loading" id="loading">
      <div class="spinner"></div>
      <p style="margin-top: 1rem; font-weight: 600;">üíæ Salvando c√°lculo...</p>
     </div>
    </div><!-- Hist√≥rico -->
    <div class="history-section fade-in" id="historySection" style="display: none;">
     <h2 class="history-title">üìä Hist√≥rico de C√°lculos</h2>
     <div class="date-filter">
      <div class="input-group" style="margin-bottom: 0;"><label class="input-label" for="filtroData">üìÖ Filtrar por Data:</label>
       <div class="filter-controls"><input type="date" id="filtroData" class="input-field"> <button type="button" class="filter-btn" onclick="mostrarHoje()"> üìÖ Hoje </button> <button type="button" class="filter-btn secondary" onclick="mostrarTodos()"> üìã Todos </button>
       </div>
      </div><!-- Filtro de Sucesso -->
      <div class="success-filter"><label class="input-label" style="margin-bottom: 0.75rem; font-size: 1rem;">üéØ Filtrar por Status da Venda:</label>
       <div class="success-filter-controls"><label> <input type="radio" name="filtroSucesso" value="todos" checked onchange="aplicarFiltroData()"> <span>üìã Todos os Registros</span> </label> <label> <input type="radio" name="filtroSucesso" value="sucesso" onchange="aplicarFiltroData()"> <span>‚úÖ Vendas Bem-Sucedidas</span> </label> <label> <input type="radio" name="filtroSucesso" value="pendente" onchange="aplicarFiltroData()"> <span>‚è≥ Vendas Pendentes</span> </label>
       </div>
      </div>
     </div>
     <div id="historyContainer">
      <div class="empty-state">
       <div class="empty-icon">
        üìä
       </div>
       <p><strong>Nenhum c√°lculo salvo ainda</strong><br>
        Fa√ßa seu primeiro c√°lculo acima para come√ßar!</p>
      </div>
     </div>
    </div>
   </main>
  </div>
  <footer class="developer-signature">
   <div class="signature-container">
    <p class="signature-main">Desenvolvido por <span class="developer-name">@FildoSobral</span></p>
    <p class="signature-subtitle">Sistema de Vendas Zenir - Calculadora de Descontos Profissional</p>
   </div>
  </footer>
  <script>
        // Configura√ß√£o padr√£o
        const defaultConfig = {
            app_title: "Sistema de Vendas Zenir",
            currency_symbol: "R$"
        };

        let currentData = [];
        let vendedorAtual = null;

        // Senha gerencial
        const SENHA_GERENTE = "@fildO1060";

        // Fun√ß√£o para atualizar a interface com base na configura√ß√£o
        async function onConfigChange(config) {
            document.getElementById('appTitle').textContent = config.app_title || defaultConfig.app_title;
            
            const currencySymbol = config.currency_symbol || defaultConfig.currency_symbol;
            document.getElementById('currencySymbol1').textContent = currencySymbol;
            document.getElementById('currencySymbol2').textContent = currencySymbol;
            document.getElementById('currencySymbol3').textContent = currencySymbol;
        }

        // Fun√ß√£o para mapear capacidades
        function mapToCapabilities(config) {
            return {
                recolorables: [],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        // Fun√ß√£o para mapear valores do painel de edi√ß√£o
        function mapToEditPanelValues(config) {
            return new Map([
                ["app_title", config.app_title || defaultConfig.app_title],
                ["currency_symbol", config.currency_symbol || defaultConfig.currency_symbol]
            ]);
        }

        // Handler para mudan√ßas nos dados
        const dataHandler = {
            onDataChanged(data) {
                console.log("üìä Dados atualizados:", data.length, "registros");
                
                if (!Array.isArray(data)) {
                    console.warn("‚ö†Ô∏è Dados recebidos n√£o s√£o um array:", data);
                    return;
                }
                
                currentData = [...data];
                
                try {
                    localStorage.setItem('calculosDesconto', JSON.stringify(data));
                } catch (error) {
                    console.error("‚ùå Erro ao sincronizar localStorage:", error);
                }
                
                if (vendedorAtual) {
                    requestAnimationFrame(() => {
                        aplicarFiltroData();
                    });
                }
            }
        };

        // Fun√ß√£o para carregar dados locais como fallback
        function carregarDadosLocais() {
            try {
                const dadosLocais = JSON.parse(localStorage.getItem('calculosDesconto') || '[]');
                if (dadosLocais.length > 0) {
                    currentData = dadosLocais;
                    if (vendedorAtual) {
                        aplicarFiltroData();
                    }
                }
            } catch (error) {
                console.error("Erro ao carregar dados locais:", error);
            }
        }

        // Mensagens motivacionais por dia da semana
        const mensagensMotivacionais = [
            "üåü Domingo √© dia de planejar grandes conquistas!",
            "üí™ Segunda-feira: Comece a semana com energia total!",
            "üöÄ Ter√ßa-feira: Vamos acelerar as vendas!",
            "‚≠ê Quarta-feira: Metade da semana, dobro de motiva√ß√£o!",
            "üî• Quinta-feira: Mantenha o ritmo forte!",
            "üéØ Sexta-feira: Finalize a semana com chave de ouro!",
            "‚ú® S√°bado: Dia de fazer a diferen√ßa nas vendas!"
        ];

        // Fun√ß√£o para obter mensagem motivacional do dia
        function obterMensagemDoDia() {
            const hoje = new Date();
            const diaDaSemana = hoje.getDay(); // 0 = Domingo, 1 = Segunda, etc.
            return mensagensMotivacionais[diaDaSemana];
        }

        // Fun√ß√£o para atualizar mensagem motivacional
        function atualizarMensagemMotivacional() {
            const motivationalElement = document.getElementById('motivationalMessage');
            if (motivationalElement) {
                motivationalElement.textContent = obterMensagemDoDia();
            }
        }

        // Inicializar SDKs
        async function initializeApp() {
            console.log("üöÄ Inicializando aplica√ß√£o...");
            
            // Atualizar mensagem motivacional
            atualizarMensagemMotivacional();
            
            try {
                // Inicializar Element SDK
                if (window.elementSdk) {
                    await window.elementSdk.init({
                        defaultConfig,
                        onConfigChange,
                        mapToCapabilities,
                        mapToEditPanelValues
                    });
                    console.log("‚úÖ Element SDK inicializado");
                }

                // Inicializar Data SDK
                if (window.dataSdk) {
                    console.log("üîÑ Inicializando Data SDK...");
                    const result = await window.dataSdk.init(dataHandler);
                    if (result.isOk) {
                        console.log("‚úÖ Data SDK inicializado");
                    } else {
                        console.warn("‚ö†Ô∏è Data SDK falhou, usando localStorage");
                        carregarDadosLocais();
                    }
                } else {
                    console.log("‚ÑπÔ∏è Data SDK n√£o dispon√≠vel, usando localStorage");
                    carregarDadosLocais();
                }
                
            } catch (error) {
                console.error("‚ùå Erro na inicializa√ß√£o:", error);
                carregarDadosLocais();
            }
            
            verificarEstadoAcesso();
        }

        // Fun√ß√£o para verificar estado de acesso
        function verificarEstadoAcesso() {
            console.log("üîç Verificando estado de acesso...");
            
            const plataformaAutorizada = localStorage.getItem('plataformaAutorizada');
            const vendedorLogado = localStorage.getItem('vendedorLogado');
            
            if (plataformaAutorizada && vendedorLogado) {
                console.log("‚úÖ Plataforma autorizada e usu√°rio logado");
                vendedorAtual = vendedorLogado;
                entrarNaCalculadora(vendedorLogado);
            } else if (plataformaAutorizada && !vendedorLogado) {
                console.log("üîê Plataforma autorizada mas usu√°rio n√£o logado");
                mostrarTelaLogin();
            } else {
                console.log("üö´ Plataforma n√£o autorizada - primeiro acesso");
                mostrarTelaAutorizacao();
            }
        }

        // Fun√ß√£o para mostrar tela de autoriza√ß√£o
        function mostrarTelaAutorizacao() {
            document.getElementById('authCard').style.display = 'block';
            document.getElementById('loginCard').style.display = 'none';
            document.getElementById('calculatorCard').style.display = 'none';
            document.getElementById('historySection').style.display = 'none';
            document.getElementById('headerActions').style.display = 'none';
        }

        // Fun√ß√£o para mostrar tela de login
        function mostrarTelaLogin() {
            document.getElementById('authCard').style.display = 'none';
            document.getElementById('loginCard').style.display = 'block';
            document.getElementById('calculatorCard').style.display = 'none';
            document.getElementById('historySection').style.display = 'none';
            document.getElementById('headerActions').style.display = 'none';
        }

        // Fun√ß√£o para processar autoriza√ß√£o
        function processarAutorizacao(nomeUsuario, senhaDigitada) {
            console.log("üîê Processando autoriza√ß√£o...");
            
            if (senhaDigitada !== SENHA_GERENTE) {
                showToast("‚ùå Senha incorreta! Verifique e tente novamente.", "error");
                
                const senhaField = document.getElementById('senhaGerente');
                if (senhaField) {
                    senhaField.value = '';
                }
                return;
            }
            
            console.log("‚úÖ Senha correta! Autorizando plataforma...");
            
            // Autorizar a plataforma permanentemente
            localStorage.setItem('plataformaAutorizada', 'true');
            localStorage.setItem('dataAutorizacao', new Date().toISOString());
            
            // Fazer login do usu√°rio atual
            vendedorAtual = nomeUsuario;
            localStorage.setItem('vendedorLogado', nomeUsuario);
            
            entrarNaCalculadora(nomeUsuario);
        }

        // Fun√ß√£o para entrar na calculadora
        function entrarNaCalculadora(nomeUsuario) {
            console.log("üöÄ Entrando na calculadora:", nomeUsuario);
            
            document.getElementById('authCard').style.display = 'none';
            document.getElementById('loginCard').style.display = 'none';
            document.getElementById('calculatorCard').style.display = 'block';
            document.getElementById('historySection').style.display = 'block';
            document.getElementById('headerActions').style.display = 'flex';
            
            // Atualizar nome do usu√°rio no menu
            const menuCurrentUser = document.getElementById('menuCurrentUser');
            if (menuCurrentUser) {
                menuCurrentUser.textContent = nomeUsuario;
            }
            
            const hoje = new Date().toISOString().split('T')[0];
            const filtroDataElement = document.getElementById('filtroData');
            if (filtroDataElement) {
                filtroDataElement.value = hoje;
            }
            
            setTimeout(() => {
                aplicarFiltroData();
            }, 200);
            
            const primeiroNome = nomeUsuario.split(' ')[0];
            showToast(`üëã Bem-vindo(a), ${primeiroNome}! Sistema pronto para uso!`, "success");
        }

        // Fun√ß√µes do menu de usu√°rios
        function toggleUserMenu() {
            const dropdown = document.getElementById('menuDropdown');
            if (dropdown) {
                dropdown.classList.toggle('active');
            }
        }

        function trocarUsuario() {
            console.log("üîÑ Trocando usu√°rio...");
            
            // Fechar menu
            const dropdown = document.getElementById('menuDropdown');
            if (dropdown) {
                dropdown.classList.remove('active');
            }
            
            // Limpar dados do usu√°rio atual mas manter plataforma autorizada
            vendedorAtual = null;
            localStorage.removeItem('vendedorLogado');
            
            // Voltar para tela de login
            mostrarTelaLogin();
            
            // Limpar formul√°rios
            document.getElementById('loginForm').reset();
            limparFormulario();
            
            showToast("üîÑ Pronto para trocar de usu√°rio!", "success");
        }

        function verHistoricoCompleto() {
            console.log("üìä Visualizando hist√≥rico completo...");
            
            // Fechar menu
            const dropdown = document.getElementById('menuDropdown');
            if (dropdown) {
                dropdown.classList.remove('active');
            }
            
            // Limpar filtro de data para mostrar todos
            const filtroDataElement = document.getElementById('filtroData');
            if (filtroDataElement) {
                filtroDataElement.value = '';
            }
            
            // Resetar filtro de sucesso para "todos"
            const filtroTodos = document.querySelector('input[name="filtroSucesso"][value="todos"]');
            if (filtroTodos) {
                filtroTodos.checked = true;
            }
            
            // Mostrar todos os registros de todos os usu√°rios
            const todosRegistros = [...currentData];
            renderHistoryComplete(todosRegistros);
            
            showToast("üìä Mostrando registros de todos os usu√°rios", "success");
        }

        // Fun√ß√£o para renderizar hist√≥rico completo (todos os usu√°rios)
        function renderHistoryComplete(data) {
            const container = document.getElementById('historyContainer');
            
            if (data.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìä</div>
                        <p><strong>Nenhum c√°lculo salvo no sistema</strong><br>Ainda n√£o h√° registros de nenhum usu√°rio.</p>
                    </div>
                `;
                return;
            }

            // Agrupar por vendedor
            const registrosPorVendedor = {};
            data.forEach(item => {
                const vendedor = item.vendedor || 'Usu√°rio Desconhecido';
                if (!registrosPorVendedor[vendedor]) {
                    registrosPorVendedor[vendedor] = [];
                }
                registrosPorVendedor[vendedor].push(item);
            });

            // Calcular estat√≠sticas gerais
            const totalRegistros = data.length;
            const vendasSucesso = data.filter(item => item.venda_bem_sucedida === true).length;
            const vendasPendentes = totalRegistros - vendasSucesso;
            const taxaSucesso = totalRegistros > 0 ? ((vendasSucesso / totalRegistros) * 100).toFixed(1) : 0;

            const sortedData = [...data].sort((a, b) => new Date(b.data_calculo) - new Date(a.data_calculo));
            const currencySymbol = (window.elementSdk?.config?.currency_symbol) || defaultConfig.currency_symbol;

            const totalVendedores = Object.keys(registrosPorVendedor).length;
            
            // Dashboard de estat√≠sticas
            const dashboardHtml = `
                <div class="dashboard-summary">
                    <div class="summary-card total">
                        <div class="summary-number" style="color: #667eea;">${totalRegistros}</div>
                        <div class="summary-label">Total de Registros</div>
                    </div>
                    <div class="summary-card success">
                        <div class="summary-number" style="color: #48bb78;">${vendasSucesso}</div>
                        <div class="summary-label">Vendas Bem-Sucedidas</div>
                    </div>
                    <div class="summary-card pending">
                        <div class="summary-number" style="color: #ed8936;">${vendasPendentes}</div>
                        <div class="summary-label">Vendas Pendentes</div>
                    </div>
                    <div class="summary-card rate">
                        <div class="summary-number" style="color: #9f7aea;">${taxaSucesso}%</div>
                        <div class="summary-label">Taxa de Sucesso</div>
                    </div>
                </div>
            `;

            const headerInfo = `
                <div style="background: rgba(147, 51, 234, 0.1); padding: 1.5rem; border-radius: 15px; margin-bottom: 1.5rem; border-left: 4px solid #9f7aea;">
                    <strong>üìä Hist√≥rico Completo - Todos os Usu√°rios</strong>
                    <div style="color: #718096; margin-top: 0.5rem; font-weight: 600; font-size: 0.9rem;">
                        ${totalVendedores} ${totalVendedores === 1 ? 'usu√°rio' : 'usu√°rios'} ‚Ä¢ 
                        ${totalRegistros} ${totalRegistros === 1 ? 'registro total' : 'registros totais'}
                    </div>
                    <div style="margin-top: 1rem; display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button onclick="aplicarFiltroData()" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 0.5rem 1rem; border-radius: 10px; font-size: 0.8rem; cursor: pointer; font-weight: 600;">
                            üîô Voltar aos Meus Registros
                        </button>
                    </div>
                </div>
            `;

            container.innerHTML = headerInfo + dashboardHtml + sortedData.map(item => `
                <div class="history-item" style="border-left-color: ${item.vendedor === vendedorAtual ? '#48bb78' : '#667eea'};">
                    <div class="history-header">
                        <span class="client-name">üë§ <strong>${item.vendedor || 'Usu√°rio Desconhecido'}</strong> ‚Ä¢ üì¶ ${item.codigo_produto || 'N/A'} - üë§ ${item.cliente}${item.whatsapp ? ` - üì± ${item.whatsapp}` : ''}</span>
                        <div style="display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap;">
                            <span class="success-status ${item.venda_bem_sucedida ? 'success' : 'pending'}">
                                ${item.venda_bem_sucedida ? '‚úÖ Bem-Sucedida' : '‚è≥ Pendente'}
                            </span>
                            <span class="history-date">${new Date(item.data_calculo).toLocaleDateString('pt-BR')} √†s ${new Date(item.data_calculo).toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})}</span>
                            <button type="button" onclick="excluirRegistro('${item.__backendId}', '${item.cliente.replace(/'/g, "\\'")}', '${item.codigo_produto || 'Produto'}')" 
                                    style="background: rgba(244, 67, 54, 0.1); border: 1px solid rgba(244, 67, 54, 0.3); color: #c62828; 
                                           width: 28px; height: 28px; border-radius: 50%; font-size: 0.8rem; font-weight: bold; 
                                           cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center;
                                           margin-left: 0.5rem;" 
                                    onmouseover="this.style.background='rgba(244, 67, 54, 0.2)'; this.style.transform='scale(1.1)'" 
                                    onmouseout="this.style.background='rgba(244, 67, 54, 0.1)'; this.style.transform='scale(1)'"
                                    title="Excluir registro">
                                ‚úï
                            </button>
                        </div>
                    </div>
                    <div class="history-details">
                        <div class="detail-item">
                            <div class="detail-label">Pre√ßo Normal</div>
                            <div class="detail-value">${currencySymbol} ${formatarMoeda(item.preco_normal)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Pre√ßo Promocional</div>
                            <div class="detail-value">${currencySymbol} ${formatarMoeda(item.preco_promocional)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Desconto Aplicado</div>
                            <div class="detail-value">${item.desconto_percentual.toFixed(1)}%</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Economia Total</div>
                            <div class="detail-value">${currencySymbol} ${formatarMoeda(item.desconto_valor)}</div>
                        </div>
                        ${item.nivel_autorizacao ? `
                        <div class="detail-item">
                            <div class="detail-label">N√≠vel de Autoriza√ß√£o</div>
                            <div class="detail-value" style="color: ${item.nivel_autorizacao === 'Vendedor' ? '#856404' : item.nivel_autorizacao === 'Gerente' ? '#e65100' : '#c62828'}; font-weight: 700;">${item.nivel_autorizacao}</div>
                        </div>
                        ` : ''}
                    </div>
                    ${item.anotacoes ? `
                        <div class="history-notes">
                            <strong>üìù Anota√ß√µes da Negocia√ß√£o:</strong>
                            <p class="notes-content">${item.anotacoes}</p>
                        </div>
                    ` : ''}
                    <div style="margin-top: 1rem; text-align: center; display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                        ${item.whatsapp ? `
                            <button type="button" class="btn btn-secondary" onclick="visualizarMensagemWhatsApp('${item.cliente.replace(/'/g, "\\'")}', '${item.whatsapp}', '${(item.codigo_produto || 'Produto').replace(/'/g, "\\'")}', ${item.preco_normal}, ${item.preco_promocional}, ${item.desconto_valor}, ${item.desconto_percentual}, '${item.tipo_preco_normal || 'vista'}', '${item.tipo_preco_promocional || 'vista'}', ${item.parcelas_normal || 'null'}, ${item.valor_parcela_normal || 'null'}, ${item.parcelas_promocional || 'null'}, ${item.valor_parcela_promocional || 'null'}, '${item.tipo_parcela_normal || 'cartao'}', '${item.tipo_parcela_promocional || 'cartao'}')" style="padding: 0.75rem 1.5rem; font-size: 0.9rem; min-width: 180px;">
                                üëÅÔ∏è Ver Mensagem
                            </button>
                            <button type="button" class="btn btn-whatsapp" onclick="enviarWhatsAppHistorico('${item.cliente.replace(/'/g, "\\'")}', '${item.whatsapp}', '${(item.codigo_produto || 'Produto').replace(/'/g, "\\'")}', ${item.preco_normal}, ${item.preco_promocional}, ${item.desconto_valor}, ${item.desconto_percentual}, '${item.tipo_preco_normal || 'vista'}', '${item.tipo_preco_promocional || 'vista'}', ${item.parcelas_normal || 'null'}, ${item.valor_parcela_normal || 'null'}, ${item.parcelas_promocional || 'null'}, ${item.valor_parcela_promocional || 'null'}, '${item.tipo_parcela_normal || 'cartao'}', '${item.tipo_parcela_promocional || 'cartao'}')" style="padding: 0.75rem 1.5rem; font-size: 0.9rem; min-width: 180px;">
                                üì± Enviar WhatsApp
                            </button>
                        ` : ''}

                        <button type="button" class="btn ${item.venda_bem_sucedida ? 'btn-secondary' : 'btn-primary'}" onclick="alterarStatusVenda('${item.__backendId}', ${!item.venda_bem_sucedida})" style="padding: 0.75rem 1.5rem; font-size: 0.9rem; min-width: 180px;">
                            ${item.venda_bem_sucedida ? '‚è≥ Marcar como Pendente' : '‚úÖ Marcar como Realizada'}
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Fun√ß√£o de login
        function fazerLogin(nomeVendedor) {
            console.log("üöÄ Fazendo login:", nomeVendedor);
            
            vendedorAtual = nomeVendedor;
            localStorage.setItem('vendedorLogado', nomeVendedor);
            
            entrarNaCalculadora(nomeVendedor);
        }

        // Fun√ß√£o de logout
        function logout() {
            console.log("üö™ Fazendo logout");
            
            // Fechar menu se estiver aberto
            const dropdown = document.getElementById('menuDropdown');
            if (dropdown) {
                dropdown.classList.remove('active');
            }
            
            vendedorAtual = null;
            localStorage.removeItem('vendedorLogado');
            
            mostrarTelaLogin();
            
            document.getElementById('loginForm').reset();
            limparFormulario();
            
            showToast("üëã Logout realizado com sucesso! At√© logo!", "success");
        }

        // Fun√ß√£o para aplicar filtro de data e sucesso
        function aplicarFiltroData() {
            if (!vendedorAtual) {
                console.log("‚ùå Nenhum vendedor logado");
                return;
            }
            
            console.log("üîç Aplicando filtros para:", vendedorAtual);
            
            if (currentData.length === 0) {
                try {
                    const dadosLocais = JSON.parse(localStorage.getItem('calculosDesconto') || '[]');
                    if (dadosLocais.length > 0) {
                        currentData = [...dadosLocais];
                    }
                } catch (error) {
                    console.error("‚ùå Erro ao recarregar dados:", error);
                }
            }
            
            const dadosVendedor = currentData.filter(item => {
                return item.vendedor === vendedorAtual;
            });
            
            const filtroDataElement = document.getElementById('filtroData');
            const dataFiltro = filtroDataElement ? filtroDataElement.value : '';
            
            // Aplicar filtro de data
            let dadosFiltrados = dadosVendedor;
            if (dataFiltro) {
                dadosFiltrados = dadosVendedor.filter(item => {
                    try {
                        const dataItem = new Date(item.data_calculo).toISOString().split('T')[0];
                        return dataItem === dataFiltro;
                    } catch (error) {
                        return false;
                    }
                });
            }
            
            // Aplicar filtro de sucesso
            const filtroSucesso = document.querySelector('input[name="filtroSucesso"]:checked')?.value || 'todos';
            if (filtroSucesso === 'sucesso') {
                dadosFiltrados = dadosFiltrados.filter(item => item.venda_bem_sucedida === true);
            } else if (filtroSucesso === 'pendente') {
                dadosFiltrados = dadosFiltrados.filter(item => item.venda_bem_sucedida !== true);
            }
            
            renderHistory(dadosFiltrados, dataFiltro, filtroSucesso);
        }

        // Fun√ß√£o para mostrar apenas hoje
        function mostrarHoje() {
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('filtroData').value = hoje;
            aplicarFiltroData();
        }

        // Fun√ß√£o para mostrar todos os registros
        function mostrarTodos() {
            document.getElementById('filtroData').value = '';
            // Resetar filtro de sucesso para "todos"
            const filtroTodos = document.querySelector('input[name="filtroSucesso"][value="todos"]');
            if (filtroTodos) {
                filtroTodos.checked = true;
            }
            aplicarFiltroData();
        }

        // Fun√ß√£o para verificar autoriza√ß√£o de desconto
        function verificarAutorizacao(percentual) {
            const statusDiv = document.getElementById('statusAutorizacao');
            const textoSpan = document.getElementById('textoAutorizacao');
            
            if (percentual <= 0) {
                statusDiv.style.display = 'none';
                return { autorizado: true, nivel: '' };
            }

            if (percentual > 10) {
                statusDiv.style.display = 'block';
                statusDiv.className = 'status-authorization status-supervisor';
                textoSpan.innerHTML = 'üö´ <strong>ACESSO NEGADO</strong><br>Desconto m√°ximo permitido: 10%';
                return { autorizado: false, nivel: 'Negado' };
            }

            statusDiv.style.display = 'block';
            statusDiv.className = 'status-authorization';
            
            if (percentual >= 1 && percentual <= 3.0) {
                statusDiv.classList.add('status-vendedor');
                textoSpan.innerHTML = '‚úÖ <strong>Autorizado - Vendedor</strong>';
                return { autorizado: true, nivel: 'Vendedor' };
            } else if (percentual > 3.0 && percentual <= 5.0) {
                statusDiv.classList.add('status-gerente');
                textoSpan.innerHTML = '‚ö†Ô∏è <strong>REQUER AUTORIZA√á√ÉO - N√çVEL GERENTE</strong><br>Fale com seu gerente para aprovar este desconto';
                return { autorizado: true, nivel: 'Gerente' };
            } else if (percentual > 5.0 && percentual <= 10.0) {
                statusDiv.classList.add('status-supervisor');
                textoSpan.innerHTML = 'üî¥ <strong>REQUER AUTORIZA√á√ÉO - N√çVEL SUPERVISOR</strong><br>Fale com seu supervisor para aprovar este desconto';
                return { autorizado: true, nivel: 'Supervisor' };
            } else if (percentual < 1) {
                statusDiv.classList.add('status-vendedor');
                textoSpan.innerHTML = '‚ö†Ô∏è <strong>M√≠nimo: 1%</strong>';
                return { autorizado: false, nivel: 'M√≠nimo' };
            }
            
            return { autorizado: true, nivel: 'Vendedor' };
        }

        // Fun√ß√£o para calcular desconto automaticamente por percentual
        function calcularDescontoAutomatico() {
            const precoNormal = converterParaNumero(document.getElementById('precoNormal').value);
            const percentualDesconto = parseFloat(document.getElementById('percentualDesconto').value) || 0;
            const precoCalculadoGroup = document.getElementById('precoCalculadoGroup');
            const precoCalculadoInput = document.getElementById('precoCalculado');

            const autorizacao = verificarAutorizacao(percentualDesconto);

            if (percentualDesconto < 1 || percentualDesconto > 10 || precoNormal <= 0) {
                precoCalculadoGroup.style.display = 'none';
                precoCalculadoInput.value = '';
                document.getElementById('precoPromocional').value = '';
                calcularResultadoFinal();
                return;
            }

            if (!autorizacao.autorizado && percentualDesconto > 10) {
                precoCalculadoGroup.style.display = 'none';
                precoCalculadoInput.value = '';
                document.getElementById('precoPromocional').value = '';
                document.getElementById('resultSection').style.display = 'none';
                return;
            }

            const fatorDesconto = 1 - (percentualDesconto / 100);
            const precoCalculado = precoNormal * fatorDesconto;

            precoCalculadoGroup.style.display = 'block';
            precoCalculadoInput.value = formatarMoeda(precoCalculado);

            document.getElementById('precoPromocional').value = '';
            calcularResultadoFinal();
        }

        // Fun√ß√£o para formatar valor como moeda brasileira
        function formatarMoeda(valor) {
            return valor.toLocaleString('pt-BR', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        // Fun√ß√£o para formatar campo de entrada
        function formatarCampoMoeda(input) {
            let valor = input.value;
            
            // Se estiver vazio, n√£o fazer nada
            if (!valor || valor.trim() === '') {
                return;
            }
            
            // Remover tudo exceto n√∫meros, v√≠rgula e ponto
            valor = valor.replace(/[^\d,\.]/g, '');
            
            if (!valor) {
                input.value = '';
                return;
            }
            
            // N√£o formatar enquanto estiver digitando - apenas limpar caracteres inv√°lidos
            input.value = valor;
        }
        
        // Fun√ß√£o para formatar ao sair do campo (blur)
        function formatarCampoMoedaBlur(input) {
            let valor = input.value;
            
            if (!valor || valor.trim() === '') {
                return;
            }
            
            // Remover tudo exceto n√∫meros, v√≠rgula e ponto
            valor = valor.replace(/[^\d,\.]/g, '');
            
            if (!valor) {
                input.value = '';
                return;
            }
            
            let numero = 0;
            
            // Se tem v√≠rgula, considerar como separador decimal
            if (valor.includes(',')) {
                let partes = valor.split(',');
                let parteInteira = partes[0].replace(/\./g, '');
                let parteDecimal = partes[1] || '00';
                
                if (parteDecimal.length > 2) {
                    parteDecimal = parteDecimal.substring(0, 2);
                }
                
                numero = parseFloat(parteInteira + '.' + parteDecimal);
            } 
            // Se tem ponto, verificar se √© separador de milhar ou decimal
            else if (valor.includes('.')) {
                let partes = valor.split('.');
                // Se tem apenas um ponto e a parte decimal tem 2 d√≠gitos ou menos, considerar como decimal
                if (partes.length === 2 && partes[1].length <= 2) {
                    numero = parseFloat(valor);
                } else {
                    // Caso contr√°rio, remover todos os pontos (s√£o separadores de milhar)
                    numero = parseFloat(valor.replace(/\./g, ''));
                }
            } 
            else {
                numero = parseFloat(valor);
            }
            
            if (!isNaN(numero) && numero >= 0) {
                input.value = numero.toLocaleString('pt-BR', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
            }
        }

        // Fun√ß√£o para converter valor formatado para n√∫mero
        function converterParaNumero(valorFormatado) {
            if (!valorFormatado) return 0;
            return parseFloat(valorFormatado.replace(/\./g, '').replace(',', '.')) || 0;
        }

        // Fun√ß√£o unificada para calcular resultado final
        function calcularResultadoFinal() {
            const precoNormal = converterParaNumero(document.getElementById('precoNormal').value);
            const precoCalculado = converterParaNumero(document.getElementById('precoCalculado').value);
            const precoPromocional = converterParaNumero(document.getElementById('precoPromocional').value);

            let precoFinal = 0;
            
            if (precoCalculado > 0) {
                precoFinal = precoCalculado;
            } else if (precoPromocional > 0) {
                precoFinal = precoPromocional;
            }

            if (precoNormal <= 0 || precoFinal <= 0 || precoFinal > precoNormal) {
                document.getElementById('resultSection').style.display = 'none';
                return;
            }

            const descontoValor = precoNormal - precoFinal;
            const descontoPercentual = (descontoValor / precoNormal) * 100;

            const currencySymbol = (window.elementSdk?.config?.currency_symbol) || defaultConfig.currency_symbol;

            const percentualElement = document.getElementById('descontoPercentual');
            const valorElement = document.getElementById('descontoValor');

            percentualElement.innerHTML = `<span style="color: white; font-weight: 800; font-size: 1.8rem;">-${descontoPercentual.toFixed(1)}%</span>`;
            valorElement.innerHTML = `<span style="color: white; font-weight: 800; font-size: 1.8rem;">${currencySymbol} ${formatarMoeda(descontoValor)}</span>`;

            document.getElementById('resultSection').style.display = 'block';
        }

        // Fun√ß√£o para limpar campo autom√°tico quando usar manual
        function limparCalculoAutomatico() {
            document.getElementById('percentualDesconto').value = '';
            document.getElementById('precoCalculadoGroup').style.display = 'none';
            document.getElementById('precoCalculado').value = '';
            document.getElementById('statusAutorizacao').style.display = 'none';
            calcularResultadoFinal();
        }

        // Fun√ß√µes para toggle de parcelas
        function toggleParcelasNormal() {
            const modalidade = document.querySelector('input[name="modalidadeNormal"]:checked').value;
            const parcelasGroup = document.getElementById('parcelasNormalGroup');
            
            if (modalidade === 'parcelado') {
                parcelasGroup.classList.add('active');
            } else {
                parcelasGroup.classList.remove('active');
                document.getElementById('parcelasNormal').value = '';
                document.getElementById('valorParcelaNormal').value = '';
            }
        }

        function toggleParcelasPromocional() {
            const modalidade = document.querySelector('input[name="modalidadePromocional"]:checked').value;
            const parcelasGroup = document.getElementById('parcelasPromocionalGroup');
            
            if (modalidade === 'parcelado') {
                parcelasGroup.classList.add('active');
            } else {
                parcelasGroup.classList.remove('active');
                document.getElementById('parcelasPromocional').value = '';
                document.getElementById('valorParcelaPromocional').value = '';
            }
        }

        // Fun√ß√£o para excluir registro
        async function excluirRegistro(backendId, nomeCliente, codigoProduto) {
            console.log("üóëÔ∏è Solicitando exclus√£o do registro:", backendId);
            
            if (!backendId) {
                showToast("‚ùå Erro: ID do registro n√£o encontrado!", "error");
                return;
            }

            // Confirma√ß√£o inline - criar bot√£o de confirma√ß√£o tempor√°rio
            const botaoExcluir = event.target;
            const textoOriginal = botaoExcluir.innerHTML;
            const estiloOriginal = botaoExcluir.style.cssText;
            
            // Transformar em bot√£o de confirma√ß√£o
            botaoExcluir.innerHTML = '‚úì';
            botaoExcluir.style.background = 'rgba(244, 67, 54, 0.9)';
            botaoExcluir.style.color = 'white';
            botaoExcluir.style.transform = 'scale(1.1)';
            botaoExcluir.title = 'Clique novamente para confirmar exclus√£o';
            
            // Criar fun√ß√£o de confirma√ß√£o
            const confirmarExclusao = async () => {
                try {
                    // Encontrar o registro nos dados atuais
                    const registroIndex = currentData.findIndex(item => item.__backendId === backendId);
                    
                    if (registroIndex === -1) {
                        showToast("‚ùå Registro n√£o encontrado!", "error");
                        return;
                    }

                    const registro = currentData[registroIndex];

                    // Excluir do Data SDK se dispon√≠vel
                    if (window.dataSdk) {
                        try {
                            const result = await window.dataSdk.delete(registro);
                            if (result.isOk) {
                                console.log("‚úÖ Registro exclu√≠do do Data SDK");
                            } else {
                                console.warn("‚ö†Ô∏è Falha no Data SDK, excluindo localmente:", result.error);
                            }
                        } catch (sdkError) {
                            console.warn("‚ö†Ô∏è Erro no Data SDK, excluindo localmente:", sdkError);
                        }
                    }

                    // Excluir dos dados locais
                    currentData.splice(registroIndex, 1);
                    
                    try {
                        localStorage.setItem('calculosDesconto', JSON.stringify(currentData));
                    } catch (error) {
                        console.error("‚ùå Erro ao salvar no localStorage:", error);
                    }

                    // Atualizar interface
                    setTimeout(() => {
                        aplicarFiltroData();
                    }, 100);

                    showToast(`üóëÔ∏è Registro de ${nomeCliente} (${codigoProduto}) exclu√≠do com sucesso!`, "success");

                } catch (error) {
                    console.error("‚ùå Erro ao excluir registro:", error);
                    showToast("‚ùå Erro ao excluir registro. Tente novamente.", "error");
                    
                    // Restaurar bot√£o original em caso de erro
                    botaoExcluir.innerHTML = textoOriginal;
                    botaoExcluir.style.cssText = estiloOriginal;
                    botaoExcluir.title = 'Excluir registro';
                }
            };
            
            // Substituir o onclick temporariamente
            botaoExcluir.onclick = confirmarExclusao;
            
            // Timeout para voltar ao estado original se n√£o confirmar
            setTimeout(() => {
                if (botaoExcluir.innerHTML === '‚úì') {
                    botaoExcluir.innerHTML = textoOriginal;
                    botaoExcluir.style.cssText = estiloOriginal;
                    botaoExcluir.title = 'Excluir registro';
                    botaoExcluir.onclick = () => excluirRegistro(backendId, nomeCliente, codigoProduto);
                }
            }, 3000);
            
            showToast("‚ö†Ô∏è Clique novamente no ‚úì para confirmar a exclus√£o", "error");
        }

        // Fun√ß√£o para alterar status da venda
        async function alterarStatusVenda(backendId, novoStatus) {
            console.log("üîÑ Alterando status da venda:", backendId, "para:", novoStatus);
            
            if (!backendId) {
                showToast("‚ùå Erro: ID do registro n√£o encontrado!", "error");
                return;
            }

            try {
                // Encontrar o registro nos dados atuais
                const registroIndex = currentData.findIndex(item => item.__backendId === backendId);
                
                if (registroIndex === -1) {
                    showToast("‚ùå Registro n√£o encontrado!", "error");
                    return;
                }

                const registro = { ...currentData[registroIndex] };
                registro.venda_bem_sucedida = novoStatus;

                // Atualizar no Data SDK se dispon√≠vel
                if (window.dataSdk) {
                    try {
                        const result = await window.dataSdk.update(registro);
                        if (result.isOk) {
                            console.log("‚úÖ Status atualizado no Data SDK");
                        } else {
                            console.warn("‚ö†Ô∏è Falha no Data SDK, atualizando localmente:", result.error);
                            // Continuar com atualiza√ß√£o local
                        }
                    } catch (sdkError) {
                        console.warn("‚ö†Ô∏è Erro no Data SDK, atualizando localmente:", sdkError);
                    }
                }

                // Atualizar dados locais
                currentData[registroIndex] = registro;
                
                try {
                    localStorage.setItem('calculosDesconto', JSON.stringify(currentData));
                } catch (error) {
                    console.error("‚ùå Erro ao salvar no localStorage:", error);
                }

                // Atualizar interface
                setTimeout(() => {
                    aplicarFiltroData();
                }, 100);

                const statusMsg = novoStatus ? 
                    "‚úÖ Venda marcada como realizada com sucesso!" : 
                    "‚è≥ Venda marcada como pendente!";
                showToast(statusMsg, "success");

            } catch (error) {
                console.error("‚ùå Erro ao alterar status:", error);
                showToast("‚ùå Erro ao alterar status. Tente novamente.", "error");
            }
        }

        // Vari√°veis globais para o modal de mensagem
        let mensagemAtual = '';
        let whatsappAtual = '';

        // Fun√ß√£o para gerar mensagem do WhatsApp
        function gerarMensagemWhatsApp(cliente, whatsapp, codigoProduto, precoNormal, precoFinal, descontoValor, descontoPercentual, tipoPrecoNormal, tipoPrecoPromocional, parcelasNormal, valorParcelaNormal, parcelasPromocional, valorParcelaPromocional, tipoParcelaNormal, tipoParcelaPromocional) {
            const currencySymbol = (window.elementSdk?.config?.currency_symbol) || defaultConfig.currency_symbol;
            const nomeVendedor = vendedorAtual || 'Vendedor';
            
            // Obter data atual (do momento do envio)
            const hoje = new Date();
            
            const dataValidadeFormatada = hoje.toLocaleDateString('pt-BR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
            
            // Formatar informa√ß√µes de pre√ßo normal
            let infoPrecoNormal = `${currencySymbol} ${formatarMoeda(precoNormal)}`;
            let parcelasNormalTexto = '';
            if (tipoPrecoNormal === 'parcelado' && parcelasNormal && valorParcelaNormal) {
                const tipoTexto = tipoParcelaNormal === 'cartao' ? 'no cart√£o' : 'no carn√™';
                parcelasNormalTexto = `\n (${parcelasNormal}x de ${currencySymbol} ${formatarMoeda(valorParcelaNormal)} ${tipoTexto})`;
            }
            
            // Formatar informa√ß√µes de pre√ßo promocional
            let infoPrecoPromocional = `${currencySymbol} ${formatarMoeda(precoFinal)}`;
            let parcelasPromocionalTexto = '';
            if (tipoPrecoPromocional === 'parcelado' && parcelasPromocional && valorParcelaPromocional) {
                const tipoTexto = tipoParcelaPromocional === 'cartao' ? 'no cart√£o' : 'no carn√™';
                parcelasPromocionalTexto = `\n(${parcelasPromocional}x de ${currencySymbol} ${formatarMoeda(valorParcelaPromocional)} ${tipoTexto})`;
            }
            
            // Calcular economia - mostrar apenas a economia relevante
            let economiaTexto = '';
            
            // Se o pre√ßo promocional for PARCELADO, mostrar economia √† prazo
            if (tipoPrecoPromocional === 'parcelado' && tipoPrecoNormal === 'parcelado' && 
                parcelasNormal && valorParcelaNormal && parcelasPromocional && valorParcelaPromocional) {
                const economiaParcelado = valorParcelaNormal - valorParcelaPromocional;
                const economiaTotalParcelado = economiaParcelado * parcelasPromocional;
                if (economiaParcelado > 0) {
                    economiaTexto = `üí∏ Voc√™ Economiza √Ä prazo: ${currencySymbol} ${formatarMoeda(economiaTotalParcelado)}`;
                }
            }
            
            // Se o pre√ßo promocional for √Ä VISTA, mostrar economia √† vista
            if (tipoPrecoPromocional === 'vista') {
                economiaTexto = `üí∞ Voc√™ Economiza √Ä Vista: ${currencySymbol} ${formatarMoeda(descontoValor)}`;
            }
            
            // Se n√£o tiver economia espec√≠fica, mostrar economia √† vista como padr√£o
            if (!economiaTexto) {
                economiaTexto = `üí∞ Voc√™ Economiza √Ä Vista: ${currencySymbol} ${formatarMoeda(descontoValor)}`;
            }
            
            return `Ol√° ${cliente}!

Obrigado por escolher a Zenir üíô
√â uma satisfa√ß√£o atend√™-lo (a)!

Estou passando pra relembrar da oferta especial üî•

üì¶ Produto: ${codigoProduto}

üí∞ Pre√ßo Normal: ${infoPrecoNormal}${parcelasNormalTexto}

üî• PRE√áO PROMOCIONAL: ${infoPrecoPromocional}${parcelasPromocionalTexto}

${economiaTexto}

üéØ Condi√ß√µes especiais:
üìÖ Data: ${dataValidadeFormatada}
üõÖ Poucas unidades desse Produto
üöö Entregas e üß∞ montagens (M√≥veis) Gr√°tis 
‚úÖ Reservo imediatamente ap√≥s confirma√ß√£o

Para n√£o perder esse valor especial üî•
√â s√≥ me sinalizar.

üë§ Vendedor: ${nomeVendedor}
üìç Iguatu 3 - Ao lado do Bradesco

AHH, N√£o esquece de conferir as ofertas do M√™süëá
üîó https://tinyurl.com/ofertas-zenir

Zenir - O Melhor Est√° Aqui! üèÜ`;
        }

        // Fun√ß√£o para visualizar mensagem do WhatsApp
        function visualizarMensagemWhatsApp(cliente, whatsapp, codigoProduto, precoNormal, precoFinal, descontoValor, descontoPercentual, tipoPrecoNormal, tipoPrecoPromocional, parcelasNormal, valorParcelaNormal, parcelasPromocional, valorParcelaPromocional, tipoParcelaNormal, tipoParcelaPromocional) {
            console.log("üëÅÔ∏è Visualizando mensagem do WhatsApp");
            
            mensagemAtual = gerarMensagemWhatsApp(cliente, whatsapp, codigoProduto, precoNormal, precoFinal, descontoValor, descontoPercentual, tipoPrecoNormal, tipoPrecoPromocional, parcelasNormal, valorParcelaNormal, parcelasPromocional, valorParcelaPromocional, tipoParcelaNormal, tipoParcelaPromocional);
            whatsappAtual = whatsapp;
            
            const messageContent = document.getElementById('messageContent');
            const messageModal = document.getElementById('messageModal');
            
            if (messageContent) {
                messageContent.textContent = mensagemAtual;
            }
            
            if (messageModal) {
                messageModal.classList.add('active');
            }
        }

        // Fun√ß√£o para fechar modal de mensagem
        function fecharModalMensagem() {
            const messageModal = document.getElementById('messageModal');
            if (messageModal) {
                messageModal.classList.remove('active');
            }
        }

        // Fun√ß√£o para copiar mensagem
        function copiarMensagem() {
            if (!mensagemAtual) {
                showToast("‚ùå Nenhuma mensagem para copiar!", "error");
                return;
            }
            
            navigator.clipboard.writeText(mensagemAtual).then(() => {
                showToast("üìã Mensagem copiada para a √°rea de transfer√™ncia!", "success");
            }).catch(err => {
                console.error("Erro ao copiar:", err);
                showToast("‚ùå Erro ao copiar mensagem. Tente novamente.", "error");
            });
        }

        // Fun√ß√£o para enviar mensagem atual
        function enviarMensagemAtual() {
            if (!mensagemAtual || !whatsappAtual) {
                showToast("‚ùå Dados da mensagem n√£o encontrados!", "error");
                return;
            }
            
            const numeroLimpo = whatsappAtual.replace(/\D/g, '');
            
            if (numeroLimpo.length < 10) {
                showToast("‚ùå WhatsApp inv√°lido!", "error");
                return;
            }
            
            const mensagemCodificada = encodeURIComponent(mensagemAtual);
            const linkWhatsApp = `https://wa.me/55${numeroLimpo}?text=${mensagemCodificada}`;
            
            try {
                window.open(linkWhatsApp, '_blank', 'noopener,noreferrer');
                showToast("üì± WhatsApp aberto! Mensagem pronta para envio!", "success");
                
                // Fechar modal
                fecharModalMensagem();
                
                // Abrir link de promo√ß√µes ap√≥s enviar WhatsApp
                setTimeout(() => {
                    window.open('https://drive.google.com/drive/folders/1Ou8GbdGjkDOAyeAcbh30okIhL_45c2GF', '_blank', 'noopener,noreferrer');
                }, 1000);
                
            } catch (error) {
                console.error("‚ùå Erro ao abrir WhatsApp:", error);
                showToast("‚ùå Erro ao abrir WhatsApp. Tente novamente.", "error");
            }
        }

        // Fun√ß√£o para enviar WhatsApp do hist√≥rico (direto sem visualizar)
        function enviarWhatsAppHistorico(cliente, whatsapp, codigoProduto, precoNormal, precoFinal, descontoValor, descontoPercentual, tipoPrecoNormal, tipoPrecoPromocional, parcelasNormal, valorParcelaNormal, parcelasPromocional, valorParcelaPromocional, tipoParcelaNormal, tipoParcelaPromocional) {
            console.log("üì± Enviando WhatsApp do hist√≥rico:", { cliente, whatsapp, codigoProduto });
            
            const numeroLimpo = whatsapp.replace(/\D/g, '');
            
            if (numeroLimpo.length < 10) {
                showToast("‚ùå WhatsApp inv√°lido no registro!", "error");
                return;
            }
            
            const mensagem = gerarMensagemWhatsApp(cliente, whatsapp, codigoProduto, precoNormal, precoFinal, descontoValor, descontoPercentual, tipoPrecoNormal, tipoPrecoPromocional, parcelasNormal, valorParcelaNormal, parcelasPromocional, valorParcelaPromocional, tipoParcelaNormal, tipoParcelaPromocional);
            
            const mensagemCodificada = encodeURIComponent(mensagem);
            const linkWhatsApp = `https://wa.me/55${numeroLimpo}?text=${mensagemCodificada}`;
            
            try {
                window.open(linkWhatsApp, '_blank', 'noopener,noreferrer');
                showToast("üì± WhatsApp aberto! Mensagem pronta para envio!", "success");
                
                // Abrir link de promo√ß√µes ap√≥s enviar WhatsApp
                setTimeout(() => {
                    window.open('https://drive.google.com/drive/folders/1Ou8GbdGjkDOAyeAcbh30okIhL_45c2GF', '_blank', 'noopener,noreferrer');
                }, 1000);
                
            } catch (error) {
                console.error("‚ùå Erro ao abrir WhatsApp:", error);
                showToast("‚ùå Erro ao abrir WhatsApp. Tente novamente.", "error");
            }
        }

        // Fun√ß√£o para salvar c√°lculo
        async function salvarCalculo() {
            const codigoProduto = document.getElementById('codigoProduto').value.trim();
            const cliente = document.getElementById('cliente').value.trim();
            const whatsapp = document.getElementById('whatsapp').value.trim();
            const anotacoes = document.getElementById('anotacoes').value.trim();
            const vendaBemSucedida = false; // Sempre salva como pendente inicialmente
            
            const precoNormal = converterParaNumero(document.getElementById('precoNormal').value);
            const percentualDesconto = parseFloat(document.getElementById('percentualDesconto').value) || 0;
            const precoCalculado = converterParaNumero(document.getElementById('precoCalculado').value);
            const precoPromocional = converterParaNumero(document.getElementById('precoPromocional').value);

            let precoFinal = 0;
            let tipoCalculo = '';
            
            if (percentualDesconto > 0 && precoNormal > 0) {
                precoFinal = precoNormal * (1 - percentualDesconto / 100);
                tipoCalculo = 'PERCENTUAL';
            } else if (precoPromocional > 0) {
                precoFinal = precoPromocional;
                tipoCalculo = 'MANUAL';
            }

            // Valida√ß√µes
            if (!codigoProduto || !cliente || !vendedorAtual) {
                showToast("‚ùå Por favor, preencha c√≥digo do produto, cliente e fa√ßa login!", "error");
                return;
            }

            if (precoNormal <= 0) {
                showToast("‚ùå Por favor, informe um pre√ßo normal v√°lido!", "error");
                return;
            }

            if (precoFinal <= 0) {
                showToast("‚ùå Por favor, calcule o desconto ou informe o pre√ßo promocional!", "error");
                return;
            }

            if (precoFinal >= precoNormal) {
                showToast("‚ùå O pre√ßo final deve ser menor que o pre√ßo normal!", "error");
                return;
            }

            if (currentData.length >= 999) {
                showToast("‚ùå Limite m√°ximo de 999 c√°lculos atingido.", "error");
                return;
            }

            const descontoValor = precoNormal - precoFinal;
            const descontoPercentual = (descontoValor / precoNormal) * 100;
            const autorizacao = verificarAutorizacao(descontoPercentual);

            // Obter informa√ß√µes de modalidade de pagamento
            const modalidadeNormal = document.querySelector('input[name="modalidadeNormal"]:checked').value;
            const modalidadePromocional = document.querySelector('input[name="modalidadePromocional"]:checked').value;
            
            // Dados de parcelamento normal
            let parcelasNormal = null;
            let valorParcelaNormal = null;
            let tipoParcelaNormal = null;
            
            if (modalidadeNormal === 'parcelado') {
                parcelasNormal = parseInt(document.getElementById('parcelasNormal').value) || null;
                valorParcelaNormal = converterParaNumero(document.getElementById('valorParcelaNormal').value) || null;
                tipoParcelaNormal = document.getElementById('tipoParcelaNormal').value;
            }
            
            // Dados de parcelamento promocional
            let parcelasPromocional = null;
            let valorParcelaPromocional = null;
            let tipoParcelaPromocional = null;
            
            if (modalidadePromocional === 'parcelado') {
                parcelasPromocional = parseInt(document.getElementById('parcelasPromocional').value) || null;
                valorParcelaPromocional = converterParaNumero(document.getElementById('valorParcelaPromocional').value) || null;
                tipoParcelaPromocional = document.getElementById('tipoParcelaPromocional').value;
            }

            const novoCalculo = {
                codigo_produto: codigoProduto,
                cliente: cliente,
                whatsapp: whatsapp,
                vendedor: vendedorAtual,
                preco_normal: precoNormal,
                preco_promocional: precoFinal,
                desconto_percentual: descontoPercentual,
                desconto_valor: descontoValor,
                nivel_autorizacao: autorizacao.nivel || 'Vendedor',
                anotacoes: anotacoes,
                data_calculo: new Date().toISOString(),
                tipo_calculo: tipoCalculo,
                tipo_preco_normal: modalidadeNormal,
                tipo_preco_promocional: modalidadePromocional,
                parcelas_normal: parcelasNormal,
                valor_parcela_normal: valorParcelaNormal,
                tipo_parcela_normal: tipoParcelaNormal,
                parcelas_promocional: parcelasPromocional,
                valor_parcela_promocional: valorParcelaPromocional,
                tipo_parcela_promocional: tipoParcelaPromocional,
                venda_bem_sucedida: vendaBemSucedida
            };

            // Mostrar loading
            const loadingElement = document.getElementById('loading');
            const salvarBtn = document.getElementById('salvarBtn');
            
            if (loadingElement) loadingElement.style.display = 'block';
            if (salvarBtn) salvarBtn.disabled = true;

            try {
                // Salvamento local garantido
                let dadosLocais = [];
                
                try {
                    dadosLocais = JSON.parse(localStorage.getItem('calculosDesconto') || '[]');
                } catch (parseError) {
                    dadosLocais = [];
                }
                
                novoCalculo.__backendId = `local_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                dadosLocais.push(novoCalculo);
                localStorage.setItem('calculosDesconto', JSON.stringify(dadosLocais));
                
                currentData = [...dadosLocais];
                
                // Tentar salvar no Data SDK
                if (window.dataSdk) {
                    try {
                        const calculoParaSDK = { ...novoCalculo };
                        delete calculoParaSDK.__backendId;
                        
                        const result = await window.dataSdk.create(calculoParaSDK);
                        if (result.isOk) {
                            console.log("‚úÖ Salvamento no Data SDK sucesso!");
                        } else {
                            console.warn("‚ö†Ô∏è Salvamento no Data SDK falhou:", result.error);
                        }
                    } catch (sdkError) {
                        console.warn("‚ö†Ô∏è Erro no Data SDK:", sdkError);
                    }
                }

                // Finalizar
                if (loadingElement) loadingElement.style.display = 'none';
                if (salvarBtn) salvarBtn.disabled = false;

                limparFormulario();
                
                if (window.dataSdk) {
                    console.log("‚è≥ Aguardando onDataChanged do Data SDK...");
                } else {
                    setTimeout(() => aplicarFiltroData(), 100);
                }

                showToast("üíæ C√°lculo salvo! Use os bot√µes no hist√≥rico para marcar como realizada.", "success");

            } catch (error) {
                console.error("üí• Erro no salvamento:", error);
                if (loadingElement) loadingElement.style.display = 'none';
                if (salvarBtn) salvarBtn.disabled = false;
                showToast("‚ùå Erro ao salvar. Tente novamente.", "error");
            }
        }

        // Fun√ß√£o para renderizar hist√≥rico
        function renderHistory(data, dataFiltro = null, filtroSucesso = 'todos') {
            const container = document.getElementById('historyContainer');
            
            if (data.length === 0) {
                let mensagem = '';
                if (dataFiltro && filtroSucesso !== 'todos') {
                    const dataFormatada = new Date(dataFiltro + 'T00:00:00').toLocaleDateString('pt-BR');
                    const tipoFiltro = filtroSucesso === 'sucesso' ? 'vendas bem-sucedidas' : 'vendas pendentes';
                    mensagem = `Nenhuma ${tipoFiltro} encontrada para <strong>${dataFormatada}</strong>.<br>Tente outra data ou altere o filtro.`;
                } else if (dataFiltro) {
                    const dataFormatada = new Date(dataFiltro + 'T00:00:00').toLocaleDateString('pt-BR');
                    mensagem = `Nenhum c√°lculo encontrado para <strong>${dataFormatada}</strong>.<br>Tente outra data ou clique em "Todos".`;
                } else if (filtroSucesso !== 'todos') {
                    const tipoFiltro = filtroSucesso === 'sucesso' ? 'vendas bem-sucedidas' : 'vendas pendentes';
                    mensagem = `Nenhuma ${tipoFiltro} encontrada.<br>Altere o filtro para ver outros registros.`;
                } else {
                    mensagem = `<strong>Nenhum c√°lculo salvo ainda</strong><br>Fa√ßa seu primeiro c√°lculo acima para come√ßar!`;
                }
                
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìä</div>
                        <p>${mensagem}</p>
                    </div>
                `;
                return;
            }

            // Calcular estat√≠sticas dos dados filtrados
            const totalRegistros = data.length;
            const vendasSucesso = data.filter(item => item.venda_bem_sucedida === true).length;
            const vendasPendentes = totalRegistros - vendasSucesso;
            const taxaSucesso = totalRegistros > 0 ? ((vendasSucesso / totalRegistros) * 100).toFixed(1) : 0;

            const sortedData = [...data].sort((a, b) => new Date(b.data_calculo) - new Date(a.data_calculo));
            const currencySymbol = (window.elementSdk?.config?.currency_symbol) || defaultConfig.currency_symbol;

            // Dashboard de estat√≠sticas
            const dashboardHtml = `
                <div class="dashboard-summary">
                    <div class="summary-card total">
                        <div class="summary-number" style="color: #667eea;">${totalRegistros}</div>
                        <div class="summary-label">Total de Registros</div>
                    </div>
                    <div class="summary-card success">
                        <div class="summary-number" style="color: #48bb78;">${vendasSucesso}</div>
                        <div class="summary-label">Vendas Bem-Sucedidas</div>
                    </div>
                    <div class="summary-card pending">
                        <div class="summary-number" style="color: #ed8936;">${vendasPendentes}</div>
                        <div class="summary-label">Vendas Pendentes</div>
                    </div>
                    <div class="summary-card rate">
                        <div class="summary-number" style="color: #9f7aea;">${taxaSucesso}%</div>
                        <div class="summary-label">Taxa de Sucesso</div>
                    </div>
                </div>
            `;

            let headerInfo = '';
            if (dataFiltro && filtroSucesso !== 'todos') {
                const dataFormatada = new Date(dataFiltro + 'T00:00:00').toLocaleDateString('pt-BR');
                const isHoje = dataFiltro === new Date().toISOString().split('T')[0];
                const tipoFiltro = filtroSucesso === 'sucesso' ? 'Vendas Bem-Sucedidas' : 'Vendas Pendentes';
                headerInfo = `
                    <div style="background: rgba(72, 187, 120, 0.1); padding: 1.5rem; border-radius: 15px; margin-bottom: 1.5rem; border-left: 4px solid #48bb78;">
                        <strong>üìä ${tipoFiltro} - ${isHoje ? 'Hoje' : dataFormatada}</strong>
                        <div style="color: #718096; margin-top: 0.5rem; font-weight: 600; font-size: 0.9rem;">(${totalRegistros} ${totalRegistros === 1 ? 'registro encontrado' : 'registros encontrados'})</div>
                    </div>
                `;
            } else if (dataFiltro) {
                const dataFormatada = new Date(dataFiltro + 'T00:00:00').toLocaleDateString('pt-BR');
                const isHoje = dataFiltro === new Date().toISOString().split('T')[0];
                headerInfo = `
                    <div style="background: rgba(72, 187, 120, 0.1); padding: 1.5rem; border-radius: 15px; margin-bottom: 1.5rem; border-left: 4px solid #48bb78;">
                        <strong>üìä ${isHoje ? 'C√°lculos de Hoje' : 'C√°lculos de ' + dataFormatada}</strong>
                        <div style="color: #718096; margin-top: 0.5rem; font-weight: 600; font-size: 0.9rem;">(${totalRegistros} ${totalRegistros === 1 ? 'registro encontrado' : 'registros encontrados'})</div>
                    </div>
                `;
            } else if (filtroSucesso !== 'todos') {
                const tipoFiltro = filtroSucesso === 'sucesso' ? 'Vendas Bem-Sucedidas' : 'Vendas Pendentes';
                headerInfo = `
                    <div style="background: rgba(113, 128, 150, 0.1); padding: 1.5rem; border-radius: 15px; margin-bottom: 1.5rem; border-left: 4px solid #718096;">
                        <strong>üéØ ${tipoFiltro}</strong>
                        <div style="color: #718096; margin-top: 0.5rem; font-weight: 600; font-size: 0.9rem;">(${totalRegistros} ${totalRegistros === 1 ? 'registro encontrado' : 'registros encontrados'})</div>
                    </div>
                `;
            } else {
                headerInfo = `
                    <div style="background: rgba(113, 128, 150, 0.1); padding: 1.5rem; border-radius: 15px; margin-bottom: 1.5rem; border-left: 4px solid #718096;">
                        <strong>üìä Todos os C√°lculos Salvos</strong>
                        <div style="color: #718096; margin-top: 0.5rem; font-weight: 600; font-size: 0.9rem;">(${totalRegistros} ${totalRegistros === 1 ? 'registro total' : 'registros totais'})</div>
                    </div>
                `;
            }

            container.innerHTML = headerInfo + dashboardHtml + sortedData.map(item => `
                <div class="history-item">
                    <div class="history-header">
                        <span class="client-name">üì¶ ${item.codigo_produto || 'N/A'} - üë§ ${item.cliente}${item.whatsapp ? ` - üì± ${item.whatsapp}` : ''}</span>
                        <div style="display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap;">
                            <span class="success-status ${item.venda_bem_sucedida ? 'success' : 'pending'}">
                                ${item.venda_bem_sucedida ? '‚úÖ Bem-Sucedida' : '‚è≥ Pendente'}
                            </span>
                            <span class="history-date">${new Date(item.data_calculo).toLocaleDateString('pt-BR')} √†s ${new Date(item.data_calculo).toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})}</span>
                            <button type="button" onclick="excluirRegistro('${item.__backendId}', '${item.cliente.replace(/'/g, "\\'")}', '${item.codigo_produto || 'Produto'}')" 
                                    style="background: rgba(244, 67, 54, 0.1); border: 1px solid rgba(244, 67, 54, 0.3); color: #c62828; 
                                           width: 28px; height: 28px; border-radius: 50%; font-size: 0.8rem; font-weight: bold; 
                                           cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center;
                                           margin-left: 0.5rem;" 
                                    onmouseover="this.style.background='rgba(244, 67, 54, 0.2)'; this.style.transform='scale(1.1)'" 
                                    onmouseout="this.style.background='rgba(244, 67, 54, 0.1)'; this.style.transform='scale(1)'"
                                    title="Excluir registro">
                                ‚úï
                            </button>
                        </div>
                    </div>
                    <div class="history-details">
                        <div class="detail-item">
                            <div class="detail-label">Pre√ßo Normal</div>
                            <div class="detail-value">${currencySymbol} ${formatarMoeda(item.preco_normal)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Pre√ßo Promocional</div>
                            <div class="detail-value">${currencySymbol} ${formatarMoeda(item.preco_promocional)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Desconto Aplicado</div>
                            <div class="detail-value">${item.desconto_percentual.toFixed(1)}%</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Economia Total</div>
                            <div class="detail-value">${currencySymbol} ${formatarMoeda(item.desconto_valor)}</div>
                        </div>
                        ${item.nivel_autorizacao ? `
                        <div class="detail-item">
                            <div class="detail-label">N√≠vel de Autoriza√ß√£o</div>
                            <div class="detail-value" style="color: ${item.nivel_autorizacao === 'Vendedor' ? '#856404' : item.nivel_autorizacao === 'Gerente' ? '#e65100' : '#c62828'}; font-weight: 700;">${item.nivel_autorizacao}</div>
                        </div>
                        ` : ''}
                    </div>
                    ${item.anotacoes ? `
                        <div class="history-notes">
                            <strong>üìù Anota√ß√µes da Negocia√ß√£o:</strong>
                            <p class="notes-content">${item.anotacoes}</p>
                        </div>
                    ` : ''}
                    <div style="margin-top: 1rem; text-align: center; display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                        ${item.whatsapp ? `
                            <button type="button" class="btn btn-secondary" onclick="visualizarMensagemWhatsApp('${item.cliente.replace(/'/g, "\\'")}', '${item.whatsapp}', '${(item.codigo_produto || 'Produto').replace(/'/g, "\\'")}', ${item.preco_normal}, ${item.preco_promocional}, ${item.desconto_valor}, ${item.desconto_percentual}, '${item.tipo_preco_normal || 'vista'}', '${item.tipo_preco_promocional || 'vista'}', ${item.parcelas_normal || 'null'}, ${item.valor_parcela_normal || 'null'}, ${item.parcelas_promocional || 'null'}, ${item.valor_parcela_promocional || 'null'}, '${item.tipo_parcela_normal || 'cartao'}', '${item.tipo_parcela_promocional || 'cartao'}')" style="padding: 0.75rem 1.5rem; font-size: 0.9rem; min-width: 180px;">
                                üëÅÔ∏è Ver Mensagem
                            </button>
                            <button type="button" class="btn btn-whatsapp" onclick="enviarWhatsAppHistorico('${item.cliente.replace(/'/g, "\\'")}', '${item.whatsapp}', '${(item.codigo_produto || 'Produto').replace(/'/g, "\\'")}', ${item.preco_normal}, ${item.preco_promocional}, ${item.desconto_valor}, ${item.desconto_percentual}, '${item.tipo_preco_normal || 'vista'}', '${item.tipo_preco_promocional || 'vista'}', ${item.parcelas_normal || 'null'}, ${item.valor_parcela_normal || 'null'}, ${item.parcelas_promocional || 'null'}, ${item.valor_parcela_promocional || 'null'}, '${item.tipo_parcela_normal || 'cartao'}', '${item.tipo_parcela_promocional || 'cartao'}')" style="padding: 0.75rem 1.5rem; font-size: 0.9rem; min-width: 180px;">
                                üì± Enviar WhatsApp
                            </button>
                        ` : ''}

                        <button type="button" class="btn ${item.venda_bem_sucedida ? 'btn-secondary' : 'btn-primary'}" onclick="alterarStatusVenda('${item.__backendId}', ${!item.venda_bem_sucedida})" style="padding: 0.75rem 1.5rem; font-size: 0.9rem; min-width: 180px;">
                            ${item.venda_bem_sucedida ? '‚è≥ Marcar como Pendente' : '‚úÖ Marcar como Realizada'}
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Fun√ß√£o para limpar formul√°rio
        function limparFormulario() {
            document.getElementById('discountForm').reset();
            document.getElementById('resultSection').style.display = 'none';
            document.getElementById('precoCalculadoGroup').style.display = 'none';
            document.getElementById('statusAutorizacao').style.display = 'none';
            
            // Resetar parcelas
            document.getElementById('parcelasNormalGroup').classList.remove('active');
            document.getElementById('parcelasPromocionalGroup').classList.remove('active');
        }

        // Fun√ß√£o para mostrar toast
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 4000);
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();

            // Event listeners para formul√°rios
            document.getElementById('authForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const nomeUsuario = document.getElementById('nomeUsuario').value.trim();
                const senhaGerente = document.getElementById('senhaGerente').value;
                
                if (nomeUsuario && senhaGerente) {
                    processarAutorizacao(nomeUsuario, senhaGerente);
                }
            });

            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const nomeVendedor = document.getElementById('nomeVendedor').value.trim();
                
                if (nomeVendedor) {
                    fazerLogin(nomeVendedor);
                }
            });

            // Event listeners para campos de moeda
            document.getElementById('precoNormal').addEventListener('input', function() {
                formatarCampoMoeda(this);
            });
            
            document.getElementById('precoNormal').addEventListener('blur', function() {
                formatarCampoMoedaBlur(this);
                calcularResultadoFinal();
            });

            document.getElementById('precoPromocional').addEventListener('input', function() {
                formatarCampoMoeda(this);
            });
            
            document.getElementById('precoPromocional').addEventListener('blur', function() {
                formatarCampoMoedaBlur(this);
                limparCalculoAutomatico();
            });

            document.getElementById('valorParcelaNormal').addEventListener('input', function() {
                formatarCampoMoeda(this);
            });
            
            document.getElementById('valorParcelaNormal').addEventListener('blur', function() {
                formatarCampoMoedaBlur(this);
            });

            document.getElementById('valorParcelaPromocional').addEventListener('input', function() {
                formatarCampoMoeda(this);
            });
            
            document.getElementById('valorParcelaPromocional').addEventListener('blur', function() {
                formatarCampoMoedaBlur(this);
            });

            // Event listener para percentual de desconto
            document.getElementById('percentualDesconto').addEventListener('input', function() {
                calcularDescontoAutomatico();
            });

            // Event listener para filtro de data
            document.getElementById('filtroData').addEventListener('change', function() {
                aplicarFiltroData();
            });

            // Event listener para bot√£o salvar
            document.getElementById('salvarBtn').addEventListener('click', function() {
                salvarCalculo();
            });

            // Fechar menu ao clicar fora
            document.addEventListener('click', function(e) {
                const userMenu = document.getElementById('userMenu');
                const dropdown = document.getElementById('menuDropdown');
                
                if (userMenu && dropdown && !userMenu.contains(e.target)) {
                    dropdown.classList.remove('active');
                }
            });
        });

        // Fun√ß√µes da calculadora
        let calculatorDisplay = '0';
        let calculatorHistory = '';
        let lastOperator = '';
        let waitingForOperand = false;

        function updateCalculatorDisplay() {
            const displayElement = document.getElementById('calculatorDisplay');
            const historyElement = document.getElementById('calculatorHistory');
            
            if (displayElement) {
                displayElement.value = calculatorDisplay;
            }
            if (historyElement) {
                historyElement.textContent = calculatorHistory;
            }
        }

        function appendNumber(number) {
            if (waitingForOperand) {
                calculatorDisplay = number;
                waitingForOperand = false;
            } else {
                calculatorDisplay = calculatorDisplay === '0' ? number : calculatorDisplay + number;
            }
            updateCalculatorDisplay();
        }

        function appendDecimal() {
            if (waitingForOperand) {
                calculatorDisplay = '0,';
                waitingForOperand = false;
            } else if (calculatorDisplay.indexOf(',') === -1) {
                calculatorDisplay += ',';
            }
            updateCalculatorDisplay();
        }

        function appendOperator(operator) {
            const inputValue = parseFloat(calculatorDisplay.replace(',', '.'));
            
            if (calculatorHistory && lastOperator && !waitingForOperand) {
                calculate();
            } else {
                calculatorHistory = calculatorDisplay;
            }
            
            lastOperator = operator;
            calculatorHistory += ` ${operator} `;
            waitingForOperand = true;
            updateCalculatorDisplay();
        }

        function calculate() {
            const inputValue = parseFloat(calculatorDisplay.replace(',', '.'));
            const historyValue = parseFloat(calculatorHistory.split(' ')[0].replace(',', '.'));
            
            if (isNaN(inputValue) || isNaN(historyValue)) return;
            
            let result = 0;
            
            switch (lastOperator) {
                case '+':
                    result = historyValue + inputValue;
                    break;
                case '-':
                    result = historyValue - inputValue;
                    break;
                case '*':
                    result = historyValue * inputValue;
                    break;
                case '/':
                    if (inputValue === 0) {
                        showToast("‚ùå Divis√£o por zero n√£o √© permitida!", "error");
                        return;
                    }
                    result = historyValue / inputValue;
                    break;
                default:
                    return;
            }
            
            calculatorDisplay = result.toLocaleString('pt-BR', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 8
            });
            calculatorHistory = '';
            lastOperator = '';
            waitingForOperand = true;
            updateCalculatorDisplay();
        }

        function calculateFunction(func) {
            const inputValue = parseFloat(calculatorDisplay.replace(',', '.'));
            
            if (isNaN(inputValue)) return;
            
            let result = 0;
            
            switch (func) {
                case 'sqrt':
                    if (inputValue < 0) {
                        showToast("‚ùå Raiz quadrada de n√∫mero negativo!", "error");
                        return;
                    }
                    result = Math.sqrt(inputValue);
                    break;
                case 'square':
                    result = inputValue * inputValue;
                    break;
                case 'percent':
                    result = inputValue / 100;
                    break;
                default:
                    return;
            }
            
            calculatorDisplay = result.toLocaleString('pt-BR', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 8
            });
            waitingForOperand = true;
            updateCalculatorDisplay();
        }

        function toggleSign() {
            const inputValue = parseFloat(calculatorDisplay.replace(',', '.'));
            if (!isNaN(inputValue) && inputValue !== 0) {
                calculatorDisplay = (-inputValue).toLocaleString('pt-BR', {
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 8
                });
                updateCalculatorDisplay();
            }
        }

        function clearAll() {
            calculatorDisplay = '0';
            calculatorHistory = '';
            lastOperator = '';
            waitingForOperand = false;
            updateCalculatorDisplay();
        }

        function clearEntry() {
            calculatorDisplay = '0';
            waitingForOperand = false;
            updateCalculatorDisplay();
        }

        function backspace() {
            if (calculatorDisplay.length > 1) {
                calculatorDisplay = calculatorDisplay.slice(0, -1);
            } else {
                calculatorDisplay = '0';
            }
            updateCalculatorDisplay();
        }

        function toggleCalculator() {
            const modal = document.getElementById('calculatorModal');
            if (modal) {
                modal.style.display = modal.style.display === 'none' ? 'flex' : 'none';
                if (modal.style.display === 'flex') {
                    updateCalculatorDisplay();
                }
            }
        }

        function closeCalculator() {
            const modal = document.getElementById('calculatorModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a3ac871755b27f5',t:'MTc2NDAwNjk4Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html> -->
        <iframe src="orcamentos_app.html" class="app-frame"></iframe>
    </div>

    <!-- BOT√ÉO VOLTAR PARA A TELA INICIAL -->
    <button class="btn-voltar" onclick="window.location.href='index.html'">
        ‚Üê Voltar
    </button>

</body>
</html>
